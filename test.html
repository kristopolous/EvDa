<script src=http://documentcloud.github.com/underscore/underscore-min.js></script>
<script src=evda.js></script>

<script>
var ev = EvDa();

// Register callbacks
ev.test('one', function(value, meta){
    console.log('test', value, meta.key, meta)
    meta.callback(true);
  })
  .when('one', function(value, meta){
    console.log('when', value, meta.key, meta);
  })
  .after('one', function(value, meta){
    console.log('after', value, meta.key, meta)
  });

ev.once('one', function(value, meta) {
  console.log('once', value, meta.key, meta);
});

// Do the set
console.log("----");
ev.set('one', 'two');
console.log("----");
ev.set('one', 'three');

var cancelHandle = ev.test('one', function(value, meta) {
  console.log("Cancelling", value, meta.key, meta);
  meta.callback(false);
});

console.log("----");
ev.set('one', 'four');

ev.remove(cancelHandle.handle);

console.log("----");
ev.set('one', 'five');
console.log("----");

ev.set({
  one: 'one',
  two: 'two',
  three: 'three'
});
console.log("----");
console.log(ev());
// RegExp based key matching
var prefix = 'pre';

// Set up a bunch of K/V pairs
for(var ix = 0; ix < 4; ix++) {
  ev.set(prefix + ix, ix);
}

// List the ones that match the standard regexp
console.log('keys matching the regex: ', ev.set(prefix + '.*'));

// Show the values.
_.each(ev.get(prefix + '.*'), function(key) {
  console.log(key, ev.get(key));
});

ev.incr('key')
console.log("Incremented key, got ", ev.get('key'));
ev.decr('key')
console.log("Decremented key, got ", ev.get('key'));
ev.decr('key')
console.log("Decremented key, got ", ev.get('key'));
ev.incr('key')
console.log("Incremented key, got ", ev.get('key'));

</script>
