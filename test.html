<script src=http://documentcloud.github.com/underscore/underscore-min.js></script>
<script src=evda.js></script>

<script>
var ev = EvDa();

// Register callbacks
ev.Event
  .test('one', function(value, meta){
    console.log('test', value, meta.key, meta)
    meta.callback(true);
  })
  .during('one', function(value, meta){
    console.log('during', value, meta.key, meta);
  })
  .after('one', function(value, meta){
    console.log('after', value, meta.key, meta)
  });

ev.Event.once('one', function(value, meta) {
  console.log('once', value, meta.key, meta);
});

// Do the set
console.log("----");
ev.Data('one', 'two');
console.log("----");
ev.Data('one', 'three');

var cancelHandle = ev.Event.test('one', function(value, meta) {
  console.log("Cancelling", value, meta.key, meta);
  meta.callback(false);
});

console.log("----");
ev.Data('one', 'four');

ev.Data.deregister(cancelHandle.handle);

console.log("----");
ev.Data('one', 'five');
console.log("----");

// RegExp based key matching
var prefix = 'pre';

// Set up a bunch of K/V pairs
for(var ix = 0; ix < 4; ix++) {
  ev.Data(prefix + ix, ix);
}

// List the ones that match the standard regexp
console.log('keys matching the regex: ', ev.Data(prefix + '.*'));

// Show the values.
_.each(ev.Data(prefix + '.*'), function(key) {
  console.log(key, ev.get(key));
});

ev.Data.incr('key')
console.log("Incremented key, got ", ev.Data('key'));
ev.Data.decr('key')
console.log("Decremented key, got ", ev.Data('key'));
ev.Data.decr('key')
console.log("Decremented key, got ", ev.Data('key'));
ev.Data.incr('key')
console.log("Incremented key, got ", ev.Data('key'));

</script>
