function EvDa(a){function F(a){return a.match(/[?*]/)}function G(a,b){return F(a)?q(n(b?b:A),function(b){return b.match(a)}):a}function H(a,b){var c={};return e(a)?(k(a,function(){c[a]=b(a)}),c):b(a)}function I(a,b,d){if(0===arguments.length)return{data:A,setters:C,events:E,globs:D};if(e(a)){var g=c.call(arguments,1);return s(a,function(a){return I.apply(I.context,[a].concat(g))})}if(1==arguments.length){if(i(a)){var h={};return k(a,function(a,b){h[a]=I(a,b,d,0,1)}),k(h,function(b){f(h[b])&&!f(a[b])&&(a[b]=h[b]())}),M(n(h)[0]),a}return H(a,function(a){return A[a]})}return I[f(b)?w:"set"].apply(this,arguments)}function J(a){k(a.$,function(b){var c=F(b)?D:E;c[b]=o(c[b],a)})}function K(a,b,c){if(e(a)){var d=a.pop();return K(G(d),function(c,d){var e=1==a.length?a[0]:a;return K(e,b,d)},c)}return i(a)?(k(a,function(b,d){F(b)?u(b,H(b,function(){return K(b,d,c)})):a[b]=K(b,d,c)}),a):(C[a]&&(C[a](function(b){I.set.call(I.context,a,b,c)}),delete C[a]),b?a in A?b.call(I.context,A[a],c):I(a,b,u(c||{},y)):a in A)}function L(a,b,c,d){a.S||(a.call(b,c,d),a.once&&J(a))}function M(a){var b=a.split("."),d=b.pop();parts_obj=[],parts_obj[d]=A[a],I.extend.apply(I.context,[b.join("."),parts_obj].concat(c.call(arguments,1)))}var b="__base",c=Array.prototype.slice,d=Object.prototype.toString,e=[].isArray||function(a){return"[object Array]"===d.call(a)},f=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},g=function(a){return!!(""===a||a&&a.charCodeAt&&a.substr)},h=function(a){return"[object Number]"===d.call(a)},i=function(a){return f(a)||g(a)||h(a)||e(a)?!1:null==a?"object"==String(a):"[object Object]"===d.call(a)||!0},j=function(a){return c.call(a)},k=[].forEach?function(a,b){if(e(a)||a.length)j(a).forEach(b);else for(var c in a)b(c,a[c])}:function(a,b){if(e(a))for(var c=0,d=a.length;d>c;c++)b(a[c],c);else for(var f in a)b(f,a[f])},l=function(a){return a.length?a[a.length-1]:void 0},m=function(a){var b=[];for(var c in a)b.push(a[c]);return b},n={}.keys||function(a){if(e(a))return a;var b=[];for(var c in a)b.push(c);return b},o=function(a,b){var c=[];return k(a,function(a){a!==b&&c.push(a)}),c},p=function(a){var b,c=[];return k(n(a).sort(),function(a){a!=b&&(b=a,c.push(a))}),c},q=function(a,b){var c=[];return k(a,function(a){b(a)&&c.push(a)}),c},r=function(a){return a&&"length"in a?a.length:0},s=[].map?function(a,b){return a.map(b)}:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c.push(b(a[d],d));return c},t=function(a){return e(a)?c.call(a):i(a)?u(a,{}):a},u=function(a){return k(c.call(arguments,1),function(b){for(var c in b)void 0!==b[c]&&(a[c]=b[c])}),a},v="first",w="on",x="after",y={once:1},z={},A=a||{},B=[],C={},D={},E={};return k([v,w,x,"test","or"],function(a){I[a]=function(c,d,e){var f=E;return d||(d=c,c=b),(d.$||(d.$=[])).push(a+c),F(c)&&(f=D),(f[a+c]||(f[a+c]=[])).push(d),u(d,e)}}),u(I,{_:{},context:this,list:{},isPaused:!1,db:A,setterMap:C,events:E,del:J,whenSet:K,isset:K,pause:function(){return I.isPaused?!1:(I.isPaused=!0,I._.set=I.set,I.set=function(){B.push(["set",arguments])},!0)},play:function(){if(I.isPaused){I.isPaused=!1;var a=EvDa();return I.set=I._.set,k(B,function(b){a[b[0]].apply(a,b[1])}),B=[],I(a.db),!0}return!1},setter:function(a,b){return C[a]=b,E[w+a]?K(a):void 0},when:function(a,b,d){if(i(a)){var h={},j={},l=function(a,d){j[d.key]=!0,-1==m(j).indexOf(!1)&&b.apply(I.context,c.call(arguments))};return k(a,function(a,b){h[a]=I.when(a,b,l),j[a]=!1}),h}if(g(b))try{var n=new Function("x","return x"+b);n(),b=n}catch(o){}return I(a,function(a){(e(b)&&b.sort().join("")===a.sort().join("")||f(b)&&b(a)||a===b)&&d.apply(I.context,c.call(arguments))})},empty:function(){for(var a in A)delete A[a]},incr:function(a,b){return b=b||1,I.set(a,h(A[a])?A[a]+b:b)},decr:function(a,b){return b=b||1,I.set(a,A[a]-b||0)},push:function(a,c){return 1==r(arguments)&&(c=a,a=b),I.set(a,[].concat(A[a]||[],[c]))},pop:function(a){return I.set(a||b,A[a].slice(0,-1))},traceList:[],group:function(a){var b=j(arguments),a=b.shift(),c=I.apply(0,b);return I.list[a]||(I.list[a]=[]),f(c)?I.list[a].push(c):k(c,function(b){I.list[a].push(b)}),function(){return I.group.apply(0,[a].concat(j(arguments)))}},extend:function(a,b){return I.set.apply(I.context,[a,u({},A[a]||{},b)].concat(c.call(arguments,2)))},set:function(a,b,d,e,f){if(z[a]>1)return A[a];z[a]=(z[a]||0)+1;var h,m,g="test"+a,i=c.call(arguments),j=r(E[g]),l=j&&!e,n=l?function(c){return m|=c===!1,--j||(m?k(E["or"+a]||[],function(a){L(a,I.context,b,d)}):I.set(a,b,d,1)),c}:{};if(n.old=t(A[a]),u(n,{meta:d||{},done:n,result:n,key:a}),l)k(E[g],function(a){a.call(I.context,b,n)}),h=A[a];else{k(I.traceList,function(a){a.call(I.context,i)}),A[a]=b;var o=function(){return k((E[v+a]||[]).concat(E[w+a]||[],E[x+a]||[]),function(a){n.last=L(a,I.context,b,n)}),b};h=f?o:o.call(I.context)}return a.length>0&&M.apply(I.context,[a].concat(c.call(arguments,2))),z[a]=0,h},fire:function(a){I.set(a,A[a])},once:function(a,b,c){return b?I.once(I(a,b,c)):u(a,y)},enable:function(a){return k(I.list[a],function(b){b.S&&b.S[a]&&delete b.S[a],0==r(b.S)&&delete b.S}),I.list[a]},setadd:function(a,b){b=e(b)?b:[b];var c=A[a]||[],d=p(c.concat(b));return c.length!=d.length?I(a,d):d},setdel:function(a,b){var c=A[a]||[],d=o(c,b);return c.length!=d.length?I(a,d):d},disable:function(a){return k(I.list[a],function(b){(b.S||(b.S={}))[a]=!0}),I.list[a]},unset:function(){var a=!0;return k(arguments,function(b){a&=b in A,delete A[b]}),a},find:function(a){return q(n(A),function(b){return b.match(a)})},changed:function(a,c){return c||(c=a,a=b),I.on(a,function(a,b){var d=r(a),e=r(b.old);1==d-e?c.call(I.context,l(a)):d>e&&c.call(I.context,j(a).slice(e))})},sniff:function(){var a={},b=+new Date,c=function(c){a[c[0]]||console.log(+new Date-b,c)},d=function(){},e=c;I.traceList.unshift(function(a){e(a)}),I.sniff=function(b){return arguments.length>0?g(b)?(a[b]=!a[b],"[Un]ignoring "+b):(e=b?c:d,b):n(a)}}}),I.setAdd=I.setadd,I.setDel=I.setdel,I.isSet=I.isset,I.get=I,I.change=I.on,I.add=I.push,I.isArray=e,I}