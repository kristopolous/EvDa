function EvDa(){function w(a,g,c,d){var e=h[d.stage][a];i(e,function(e,i){d.result[i]=e(g,{meta:c,oldValue:d.oldValue,currentValue:b[a],key:a,deregister:function(){e.rm=!0}})});i(e,function(a){a.rm&&m(a)})}function p(a,g,c){var d=b[a],e={};b[a]=g;i(["during","after"],function(b){w(a,g,c,{result:e,stage:b,oldValue:d})});l[a]=!1;return e}function x(a,g,c){function d(b){b=b!==!1;e+=b;f+=!b;e+f==h.test[a].length&&(f||p(a,g,c),l[a]=!1)}var e=0,f=0;i(h.test[a],function(e){e(g,{meta:c,oldValue:b[a],callback:d,
key:a,deregister:function(){m(e)}})})}function y(a){a.ix=++z;a.refList=[];q[a.ix]=a}function k(a,g,b){var d={};i(r([a]),function(a){var f;l[a]||(l[a]=!0,f=h.test[a]?x(a,g,b):p(a,g,b));d[a]=f});return d}function m(a){i(a.refList,function(b){var c=b[0],b=b[1];h[c][b]=_.without(h[c][b],a)});delete q[a.ix]}function s(a){var b={};a.scope=a.scope?[a.scope]:[];a.meta=a.meta||[];i(t(j),function(c){b[c]=function(){j[c].apply(this,a.scope.concat(n.call(arguments),a.meta));return b}});return b}var f={},i=_.each,
t=_.keys,o=_.extend,r=_.flatten,A=_.isFunction,u=_.isArray,B=_.isNumber,v=_.isObject,n=Array.prototype.slice,b={},z=0,q={},h={},l={},j={},j={push:function(a,g){b[a]=b[a]||[];b[a].current=b[a].push(g);return k(a,b[a])},pop:function(a){b[a].pop();b[a].current=_.last(b[a]);return k(a,b[a])},once:function(a,b){var c=j.during(a,b);c.handle.once=!0;return c},decr:function(a){return k(a,b[a]-1||0)},incr:function(a){return k(a,B(b[a])?b[a]+1:1)},notNull:function(a,g){if(a in b&&b[a]!==null)g(b[a]);else return j.once(a,
g)},share:function(a){return s({meta:a})},run:k,deregister:m};i(["test","during","after"],function(a){h[a]={};j[a]=function(b,c){y(c);i(r([b]),function(b){h[a][b]=(h[a][b]||[]).concat(c);c.refList.push([a,b])});return o({handle:c},j)}});f.Event=function(a,b){var c=arguments.length;if(c==0)return h;var d=s({scope:a});A(b)?d.during(b):c>1?d.run(b):v(a)&&(d={},i(a,function(b){d[b]=f.Event(b,a[b])}));return d};f.Data=function(a,g){var c=n.call(arguments),d=c.length,e={},h;if(d==0)return b;if(v(a))return i(a,
function(b){e[b]=f.Data(b,a[b])}),e;if(d==1){if(a.search(/[\*\?]/)!=-1)return h=RegExp(a,"ig"),_.select(t(b),function(a){return a.match(h)});if(u(b[a]))try{b[a].slice()}catch(j){b[a]=n.call(b[a])}return b[a]}u(this)&&(c=c.concat(this));return k.apply(0,c)};o(f.Event,j);o(f.Data,j);f.get=f.set=f.Data;return f};
