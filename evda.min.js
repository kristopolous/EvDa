function EvDa(){function s(a,c,d,e){var f=g[e.stage][a];j(f,function(f,h){e.result[h]=f(c,{meta:d,oldValue:e.oldValue,currentValue:b[a],key:a,remove:function(){f.rm=!0}})});for(var h in f)h.rm&&m(h)}function n(a,c,d){var e=b[a],f={};b[a]=c;j(["during","after"],function(b){s(a,c,d,{result:f,stage:b,oldValue:e})});l[a]=!1;return f}function t(a,c,d){function e(b){f--;h+=b===!1;f||(h||n(a,c,d),l[a]=!1)}var f=g.test[a].length,h=0;j(g.test[a],function(f){f(c,{meta:d,oldValue:b[a],callback:e,key:a,remove:function(){m(f)}})})}
function u(a){a.refList=[];o[a.ix=++v]=a}function k(a,c,d){var b={};j(p([a]),function(a){var h;l[a]||(l[a]=!0,h=g.test[a]?t(a,c,d):n(a,c,d));b[a]=h});return b}function m(a){j(a.refList,function(c){var b=c[0],c=c[1];g[b][c]=_.without(g[b][c],a)});delete o[a.ix]}function w(a){var c={};a.scope=a.scope?[a.scope]:[];a.meta=a.meta||[];j(q(i),function(b){c[b]=function(){i[b].apply(this,a.scope.concat(x.call(arguments),a.meta));return c}});return c}function i(a,c){var d=arguments.length,e={};if(d==0)return[b,
g];if(_.isObject(a))return j(a,function(a,b){e[b]=i(b,a)}),e;if(d==1)return a.search(/[\*\?]/)!=-1?(keyRegex=RegExp(a,"ig"),_.select(q(b),function(a){return a.match(keyRegex)})):b[a];e=w({scope:a});_.isFunction(c)?e.during(c):d>1&&e.run(c);return e}var j=_.each,q=_.keys,r=_.extend,p=_.flatten,x=Array.prototype.slice,b={},v=0,o={},g={},l={};j(["test","during","after"],function(a){g[a]={};i[a]=function(b,d){u(d);j(p([b]),function(b){g[a][b]=(g[a][b]||[]).concat(d);d.refList.push([a,b])});return r(i,
{handle:d})}});return r(i,{push:function(a,c){b[a]=b[a]||[];b[a].current=b[a].push(c);return k(a,b[a])},pop:function(a){b[a].pop();b[a].current=_.last(b[a]);return k(a,b[a])},once:function(a,b){var d=i.during(a,b);d.handle.once=!0;return d},decr:function(a){return k(a,b[a]-1||0)},incr:function(a){return k(a,_.isNumber(b[a])?b[a]+1:1)},notNull:function(a,c){if(a in b&&b[a]!==null)c(b[a]);else return i.once(a,c)},run:k,get:i,set:i,remove:m})};
