function EvDa(a){function G(a){return a.match(/[?*]/)}function H(a,b){return G(a)?p(m(b?b:A),function(b){return b.match(a)}):a}function I(a,b){var c={};return d(a)?(j(a,function(){c[a]=b(a)}),c):b(a)}function J(a){if(a in A)return A[a];var b=a.split("."),c=b.pop(),d=b.join(".");if(d){var e=J(d);if(h(e)&&c in e)return e[c]}}function K(a,c,f){if(0===arguments.length)return{data:A,setters:D,events:F,globs:E};if(d(a)){var g=b.call(arguments,1);return r(a,function(a){return K.apply(K.context,[a].concat(g))})}if(1==arguments.length){if(h(a)){var i={};return j(a,function(a,b){i[a]=K(a,b,f,0,1)}),j(i,function(b){e(i[b])&&!e(a[b])&&(a[b]=i[b]())}),O(m(i)[0]),a}return I(a,J)}return K[e(c)||d(c)&&e(c[0])?v:"set"].apply(this,arguments)}function L(a){j(a.$,function(b){var c=G(b)?E:F;c[b]=n(c[b],a)})}function M(a,b,c){if(d(a)){var e=a.pop();return M(H(e),function(c,d){var e=1==a.length?a[0]:a;return M(e,b,d)},c)}return h(a)?(j(a,function(b,d){G(b)?t(b,I(b,function(){return M(b,d,c)})):a[b]=M(b,d,c)}),a):(D[a]&&(D[a](function(b){K.set.call(K.context,a,b,c)}),delete D[a]),b?a in A?b.call(K.context,A[a],c):K(a,b,t(c||{},x)):a in A)}function N(a,b,c,d){a.S||(a.call(b,c,d),a.once&&L(a))}function O(a){var c=a.split("."),d=c.pop();parts_obj=[],parts_obj[d]=A[a],K.extend.apply(K.context,[c.join("."),parts_obj].concat(b.call(arguments,1)))}var b=Array.prototype.slice,c=Object.prototype.toString,d=[].isArray||function(a){return"[object Array]"===c.call(a)},e=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},f=function(a){return!!(""===a||a&&a.charCodeAt&&a.substr)},g=function(a){return"[object Number]"===c.call(a)},h=function(a){return e(a)||f(a)||g(a)||d(a)?!1:null==a?"object"==String(a):"[object Object]"===c.call(a)||!0},i=function(a){return b.call(a)},j=[].forEach?function(a,b){if(d(a)||a.length)i(a).forEach(b);else for(var c in a)b(c,a[c])}:function(a,b){if(d(a))for(var c=0,e=a.length;e>c;c++)b(a[c],c);else for(var f in a)b(f,a[f])},k=function(a){return a.length?a[a.length-1]:void 0},l=function(a){var b=[];for(var c in a)b.push(a[c]);return b},m={}.keys||function(a){if(d(a))return a;var b=[];for(var c in a)b.push(c);return b},n=function(a,b){var c=[];return j(a,function(a){a!==b&&c.push(a)}),c},o=function(a){var b,c=[];return j(m(a).sort(),function(a){a!=b&&(b=a,c.push(a))}),c},p=function(a,b){var c=[];return j(a,function(a){b(a)&&c.push(a)}),c},q=function(a){return a&&"length"in a?a.length:0},r=[].map?function(a,b){return a.map(b)}:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c.push(b(a[d],d));return c},s=function(a){return d(a)?b.call(a):h(a)?t(a,{}):a},t=function(a){return j(b.call(arguments,1),function(b){for(var c in b)void 0!==b[c]&&(a[c]=b[c])}),a},u="first",v="on",w="after",x={once:1},y={},z={},A=a||{},C=[],D={},E={},F={};return j([u,v,w,"test","or"],function(a){K[a]=function(c,d,e){if(_.isArray(d)){var f=b.call(arguments,2);return r(d,function(b){return K[a].apply(K.context,[c,b].concat(f))})}var g=F;return d?((d.$||(d.$=[])).push(a+c),G(c)&&(g=E),(g[a+c]||(g[a+c]=[])).push(d),t(d,e)):g[a+c]}}),t(K,{_:{},context:this,list:{},isPaused:!1,db:A,setterMap:D,events:F,del:L,whenSet:M,isset:M,pause:function(){return K.isPaused?!1:(K.isPaused=!0,K._.set=K.set,K.set=function(){C.push(["set",arguments])},!0)},play:function(){if(K.isPaused){K.isPaused=!1;var a=EvDa();return K.set=K._.set,j(C,function(b){a[b[0]].apply(a,b[1])}),C=[],K(a.db),!0}return!1},setter:function(a,b){return D[a]=b,F[v+a]?M(a):void 0},when:function(a,c,g){if(h(a)){var i={},k={},m=function(a,b){k[b.key]=!1,b()},n=function(a,d){k[d.key]=!0,-1==l(k).indexOf(!1)&&c.apply(K.context,b.call(arguments))};return j(a,function(a,b){i[a+"-test"]=K.test(a,m),i[a]=K.when(a,b,n),k[a]=!1}),i}if(f(c))try{var o=new Function("x","return x"+c);o(),c=o}catch(p){}return K(a,function(a){(d(c)&&c.sort().join("")===a.sort().join("")||e(c)&&c(a)||a===c)&&g.apply(K.context,b.call(arguments))})},empty:function(){for(var a in A)delete A[a]},incr:function(a,b){return b=b||1,K.set(a,g(A[a])?A[a]+b:b)},decr:function(a,b){return b=b||1,K.set(a,A[a]-b||0)},push:function(a,b){return K.set(a,[].concat(A[a]||[],[b]))},pop:function(a){return K.set(a,A[a].slice(0,-1))},traceList:[],group:function(a){var b=i(arguments),a=b.shift(),c=K.apply(0,b);return K.list[a]||(K.list[a]=[]),e(c)?K.list[a].push(c):j(c,function(b){K.list[a].push(b)}),function(){return K.group.apply(0,[a].concat(i(arguments)))}},extend:function(a,c){return K.set.apply(K.context,[a,t({},A[a]||{},c)].concat(b.call(arguments,2)))},set:function(a,c,d,e,f){if(1==arguments.length){var g=function(){K.set.apply(K.context,[a].concat(b.call(arguments)))};return K.set.call(K.context,a,void 0),g}if(y[a]>0)return A[a];y[a]=(y[a]||0)+1;var i,n,h="test"+a,k=b.call(arguments),l=q(F[h]),m=l&&!e,o=m?function(b){return n|=b===!1,--l||(n?j(F["or"+a]||[],function(a){N(a,K.context,c,d)}):K.set(a,c,d,1)),b}:{};if(o.old=s(A[a]),t(o,{meta:d||{},done:o,result:o,key:a}),m)y[a]--,z[a]!==!0&&(z[a]=!0,j(F[h],function(a){a.call(K.context,c,o)}),z[a]=!1),i=A[a];else{j(K.traceList,function(a){a.call(K.context,k)}),A[a]=c;var p=arguments,r=function(){return j((F[u+a]||[]).concat(F[v+a]||[]),function(a){o.last=N(a,K.context,c,o)}),a.length>0&&O.apply(K.context,[a].concat(b.call(p,2))),j(F[w+a]||[],function(a){o.last=N(a,K.context,c,o)}),c};i=f?r:r.call(K.context)}return y[a]=0,i},fire:function(a){K.set(a,A[a])},once:function(a,b,c){return h(a)&&(a=l(a)),d(a)?r(a,function(a){K.once.call(K.context,a,b,c)}):b?K.once(K(a,b,c)):t(a,x)},enable:function(a){return j(K.list[a],function(b){b.S&&b.S[a]&&delete b.S[a],0==q(b.S)&&delete b.S}),K.list[a]},setadd:function(a,b){b=d(b)?b:[b];var c=A[a]||[],e=o(c.concat(b));return c.length!=e.length?K(a,e):e},setdel:function(a,b){var c=A[a]||[],d=n(c,b);return c.length!=d.length?K(a,d):d},disable:function(a){return j(K.list[a],function(b){(b.S||(b.S={}))[a]=!0}),K.list[a]},unset:function(){var a=!0;return j(arguments,function(b){a&=b in A,delete A[b]}),a},find:function(a){return p(m(A),function(b){return b.match(a)})},changed:function(a,b){return K.on(a,function(a,c){var d=q(a),e=q(c.old);1==d-e?b.call(K.context,k(a)):d>e&&b.call(K.context,i(a).slice(e))})},sniff:function(){var a={},b=+new Date,c=function(c){a[c[0]]||console.log(+new Date-b,c)},d=function(){},e=c;K.traceList.unshift(function(a){e(a)}),K.sniff=function(b){return arguments.length>0?f(b)?(a[b]=!a[b],"[Un]ignoring "+b):(e=b?c:d,b):m(a)}}}),K.setAdd=K.setadd,K.setDel=K.setdel,K.isSet=K.isset,K.get=K,K.change=K.on,K.add=K.push,K.isArray=d,K}