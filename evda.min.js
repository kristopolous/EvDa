function EvDa(s){function p(a,b,f){var i=c[a],d,j={};c[a]=b;g(m,function(c){d=h[c+a];g(d,function(d,c){j[c]=d(b,{meta:f,old:i,now:b,key:a,del:function(){d.X=1}})});g(d,function(a){a.X&&n(a)})});k[a]=0;return j}function t(a,b,f){function i(d){j--;e+=d===!1;j||(e||p(a,b,f),k[a]=0)}var d=o+a,j=h[d].length,e=0;g(h[d],function(d){d(b,{meta:f,old:c[a],done:i,key:a,del:function(){n(d)}})})}function u(a,b,f){var c={};g(q([a]),function(a){k[a]||(k[a]=1,c[a]=h[o+a]?t(a,b,f):p(a,b,f))});return c}function n(a){g(a.$,
function(b){h[b]=_.without(h[b],a)})}function e(a,b,f){var i=arguments.length,d={};return i==1?_.isObject(a)?(g(a,function(a,b){d[b]=e(b,a)}),d):a.search(/[*?]/)+1?_.select(_.keys(c),function(b){return b.match(a)}):c[a]:i?e[_.isFunction(b)?"when":"set"](a,b,f):{data:c,events:h}}var g=_.each,r=_.extend,q=_.flatten,c=s||{},l={},o="test",m=[o,"when","after"],h={},k={};g(m,function(a){e[a]=function(b,c){c.$||(c.$=[]);g(q([b]),function(b){(h[a+b]||(h[a+b]=[])).push(c);c.$.push(a+b)});return c}});m.shift();
return r(e,{once:function(a,b){return r(e.when(a,b),{X:1})},setter:function(a,b){l[a]=b;a in c&&e.isset(a)},isset:function(a,b){l[a]&&(l[a](),l[a]=0);return b?a in c?b(c[a]):e.once(a,b):a in c},on:e,set:function(a,b,c){return u(a,arguments.length-1?b:1,c)},unset:function(a){delete c[a]},del:n})};
