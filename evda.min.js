function EvDa(){function w(a,d,c,f){var g=h[f.stage][a];i(g,function(g,i){f.result[i]=g(d,{meta:c,oldValue:f.oldValue,currentValue:b[a],key:a,deregister:function(){g.once=!0}})});i(g,function(a){a.once&&m(a)})}function p(a,d,c){var f=b[a],g={};b[a]=d;i(["invoke","after"],function(b){w(a,d,c,{result:g,stage:b,oldValue:f})});l[a]=!1;return g}function x(a,d,c){function f(b){b=b!==!1;g+=b;e+=!b;g+e==h.test[a].length&&(e||p(a,d,c),l[a]=!1)}var g=0,e=0;i(h.test[a],function(g){g(d,{meta:c,oldValue:b[a],
callback:f,key:a,deregister:function(){m(g)}})})}function y(a){a.ix=++z;a.refList=[];return q[a.ix]=a}function k(a,d,b){var f={};r(a)&&(a=[a]);i(a,function(a){var e;l[a]||(l[a]=!0,e=h.test[a]?x(a,d,b):p(a,d,b));f[a]=e});return f}function m(a){a.refList&&i(a.refList,function(d){var b=d[0],d=d[1];h[b][d]=_.without(h[b][d],a)});delete q[a.ix]}function s(a){var b={};a.scope=a.scope?[a.scope]:[];a.meta=a.meta||[];i(t(e),function(c){b[c]=function(){e[c].apply(this,a.scope.concat(n.call(arguments),a.meta));
return b}});return b}var j={},i=_.each,t=_.keys,o=_.extend,A=_.isFunction,u=_.isArray,r=_.isString,B=_.isNumber,v=_.isObject,n=Array.prototype.slice,b={},z=0,q={},h={},l={},e={},e={push:function(a,d){b[a]=b[a]||[];b[a].current=b[a].push(d);return k(a,b[a])},pop:function(a){b[a].pop();b[a].current=_.last(b[a]);return k(a,b[a])},onSet:function(a,b){return e.invoke(a,b).handle},once:function(a,b){var c=e.onSet(a,b);c.once=!0;return c},decr:function(a){return k(a,b[a]-1||0)},incr:function(a){return k(a,
B(b[a])?b[a]+1:1)},notNull:function(a,d){if(a in b&&b[a]!==null)d(b[a]);else return e.once(a,d)},share:function(a){return s({meta:a})},run:k,deregister:m};i(["test","invoke","after"],function(a){h[a]={};e[a]=function(b,c){c&&(c=y(c),r(b)&&(b=[b]),i(b,function(b){h[a][b]=(h[a][b]||[]).concat(c);c.refList.push([a,b])}));return o({handle:c},e)}});j.Event=function(a,b){var c=arguments.length;if(c==0)return h;var f=s({scope:a});A(b)?f.invoke(b):c>1?f.run(b):v(a)&&(f={},i(a,function(b){f[b]=j.Event(b,a[b])}));
return f};j.Data=function(a,d){var c=n.call(arguments),f=c.length,e={},h;if(f==0)return b;if(v(a))return i(a,function(b){e[b]=j.Data(b,a[b])}),e;if(f==1){if(a.search(/[\*\?]/)!=-1)return h=RegExp(a,"ig"),_.select(t(b),function(a){return a.match(h)});if(u(b[a]))try{b[a].slice()}catch(l){b[a]=n.call(b[a])}return b[a]}u(this)&&(c=c.concat(this));return k.apply(this,c)};o(j.Event,e);o(j.Data,e);j.get=j.set=j.Data;return j};
