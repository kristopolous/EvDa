function EvDa(a){function E(a){return a.match(/[?*]/)}function F(a,b){return E(a)?p(m(b?b:z),function(b){return b.match(a)}):a}function G(a,b){var c={};return e(a)?(k(a,function(){c[a]=b(a)}),c):b(a)}function H(a,b,d){if(0===arguments.length)return{data:z,setters:B,events:D,globs:C};if(e(a)){var g=c.call(arguments,1);return r(a,function(a){return H.apply(H.context,[a].concat(g))})}if(1==arguments.length){if(i(a)){var h={};return k(a,function(a,b){h[a]=H(a,b,d,0,1)}),k(h,function(b){f(h[b])&&!f(a[b])&&(a[b]=h[b]())}),L(m(h)[0]),a}return G(a,function(a){return z[a]})}return H[f(b)?v:"set"].apply(this,arguments)}function I(a){k(a.$,function(b){var c=E(b)?C:D;c[b]=n(c[b],a)})}function J(a,b,c){if(e(a)){var d=a.pop();return J(F(d),function(c,d){var e=1==a.length?a[0]:a;return J(e,b,d)},c)}return i(a)?(k(a,function(b,d){E(b)?t(b,G(b,function(){return J(b,d,c)})):a[b]=J(b,d,c)}),a):(B[a]&&(B[a](function(b){H.set.call(H.context,a,b,c)}),delete B[a]),b?a in z?b.call(H.context,z[a],c):H(a,b,t(c||{},x)):a in z)}function K(a,b,c,d){a.S||(a.call(b,c,d),a.once&&I(a))}function L(a){var b=a.split("."),d=b.pop();parts_obj=[],parts_obj[d]=z[a],H.extend.apply(H.context,[b.join("."),parts_obj].concat(c.call(arguments,1)))}var b="__base",c=Array.prototype.slice,d=Object.prototype.toString,e=[].isArray||function(a){return"[object Array]"===d.call(a)},f=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},g=function(a){return!!(""===a||a&&a.charCodeAt&&a.substr)},h=function(a){return"[object Number]"===d.call(a)},i=function(a){return f(a)||g(a)||h(a)||e(a)?!1:null==a?"object"==String(a):"[object Object]"===d.call(a)||!0},j=function(a){return c.call(a)},k=[].forEach?function(a,b){if(e(a)||a.length)j(a).forEach(b);else for(var c in a)b(c,a[c])}:function(a,b){if(e(a))for(var c=0,d=a.length;d>c;c++)b(a[c],c);else for(var f in a)b(f,a[f])},l=function(a){return a.length?a[a.length-1]:void 0},m={}.keys||function(a){if(e(a))return a;var b=[];for(var c in a)b.push(c);return b},n=function(a,b){var c=[];return k(a,function(a){a!==b&&c.push(a)}),c},o=function(a){var b,c=[];return k(m(a).sort(),function(a){a!=b&&(b=a,c.push(a))}),c},p=function(a,b){var c=[];return k(a,function(a){b(a)&&c.push(a)}),c},q=function(a){return a&&"length"in a?a.length:0},r=[].map?function(a,b){return a.map(b)}:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c.push(b(a[d],d));return c},s=function(a){return e(a)?c.call(a):i(a)?t(a,{}):a},t=function(a){return k(c.call(arguments,1),function(b){for(var c in b)void 0!==b[c]&&(a[c]=b[c])}),a},u="first",v="on",w="after",x={once:1},y={},z=a||{},A=[],B={},C={},D={};return k([u,v,w,"test","or"],function(a){H[a]=function(c,d,e){var f=D;return d||(d=c,c=b),(d.$||(d.$=[])).push(a+c),E(c)&&(f=C),(f[a+c]||(f[a+c]=[])).push(d),t(d,e)}}),t(H,{_:{},context:this,list:{},isPaused:!1,db:z,setterMap:B,events:D,del:I,whenSet:J,isset:J,pause:function(){return H.isPaused?!1:(H.isPaused=!0,H._.set=H.set,H.set=function(){A.push(["set",arguments])},!0)},play:function(){if(H.isPaused){H.isPaused=!1;var a=EvDa();return H.set=H._.set,k(A,function(b){a[b[0]].apply(a,b[1])}),A=[],H(a.db),!0}return!1},setter:function(a,b){return B[a]=b,D[v+a]?J(a):void 0},when:function(a,b,c){if(g(b))try{var d=new Function("x","return x"+b);d(),b=d}catch(h){}return H(a,function(a){(e(b)&&b.sort().join("")===a.sort().join("")||f(b)&&b(a)||a===b)&&c.call(H.context,a)})},empty:function(){for(var a in z)delete z[a]},incr:function(a,b){return b=b||1,H.set(a,h(z[a])?z[a]+b:b)},decr:function(a,b){return b=b||1,H.set(a,z[a]-b||0)},push:function(a,c){return 1==q(arguments)&&(c=a,a=b),H.set(a,[].concat(z[a]||[],[c]))},pop:function(a){return H.set(a||b,z[a].slice(0,-1))},traceList:[],group:function(a){var b=j(arguments),a=b.shift(),c=H.apply(0,b);return H.list[a]||(H.list[a]=[]),f(c)?H.list[a].push(c):k(c,function(b){H.list[a].push(b)}),function(){return H.group.apply(0,[a].concat(j(arguments)))}},extend:function(a,b){return H.set.apply(H.context,[a,t({},z[a]||{},b)].concat(c.call(arguments,2)))},set:function(a,b,d,e,f){if(y[a]>1)return z[a];y[a]=(y[a]||0)+1;var h,m,g="test"+a,i=c.call(arguments),j=q(D[g]),l=j&&!e,n=l?function(c){return m|=c===!1,--j||(m?k(D["or"+a]||[],function(a){K(a,H.context,b,d)}):H.set(a,b,d,1)),c}:{};if(n.old=s(z[a]),t(n,{meta:d||{},done:n,result:n,key:a}),l)k(D[g],function(a){a.call(H.context,b,n)}),h=z[a];else{k(H.traceList,function(a){a.call(H.context,i)}),z[a]=b;var o=function(){return k((D[u+a]||[]).concat(D[v+a]||[],D[w+a]||[]),function(a){n.last=K(a,H.context,b,n)}),b};h=f?o:o.call(H.context)}return a.length>0&&L.apply(H.context,[a].concat(c.call(arguments,2))),y[a]=0,h},fire:function(a){H.set(a,z[a])},once:function(a,b,c){return b?H.once(H(a,b,c)):t(a,x)},enable:function(a){return k(H.list[a],function(b){b.S&&b.S[a]&&delete b.S[a],0==q(b.S)&&delete b.S}),H.list[a]},setadd:function(a,b){b=e(b)?b:[b];var c=z[a]||[],d=o(c.concat(b));return c.length!=d.length?H(a,d):d},setdel:function(a,b){var c=z[a]||[],d=n(c,b);return c.length!=d.length?H(a,d):d},disable:function(a){return k(H.list[a],function(b){(b.S||(b.S={}))[a]=!0}),H.list[a]},unset:function(){var a=!0;return k(arguments,function(b){a&=b in z,delete z[b]}),a},find:function(a){return p(m(z),function(b){return b.match(a)})},changed:function(a,c){return c||(c=a,a=b),H.on(a,function(a,b){var d=q(a),e=q(b.old);1==d-e?c.call(H.context,l(a)):d>e&&c.call(H.context,j(a).slice(e))})},sniff:function(){var a={},b=+new Date,c=function(c){a[c[0]]||console.log(+new Date-b,c)},d=function(){},e=c;H.traceList.unshift(function(a){e(a)}),H.sniff=function(b){return arguments.length>0?g(b)?(a[b]=!a[b],"[Un]ignoring "+b):(e=b?c:d,b):m(a)}}}),H.setAdd=H.setadd,H.setDel=H.setdel,H.isSet=H.isset,H.get=H,H.change=H.on,H.add=H.push,H.isArray=e,H}