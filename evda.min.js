function EvDa(s){function n(a,c,e){var g=b[a],f,d={};b[a]=c;h(l,function(b){f=i[b][a];h(f,function(b,f){d[f]=b(c,{meta:e,old:g,current:c,key:a,remove:function(){b.rm=!0}})});h(f,function(a){a.rm&&m(a)})});k[a]=!1;return d}function t(a,c,e){function g(b){f--;d+=b===!1;f||(d||n(a,c,e),k[a]=!1)}var f=i.test[a].length,d=0;h(i.test[a],function(f){f(c,{meta:e,old:b[a],callback:g,key:a,remove:function(){m(f)}})})}function u(a){a.refs=[];o[a.ix=++v]=a}function j(a,c,b){var d={};h(p([a]),function(a){k[a]||
(k[a]=!0,d[a]=i.test[a]?t(a,c,b):n(a,c,b))});return d}function m(a){h(a.refs,function(c){var b=c[0],c=c[1];i[b][c]=_.without(i[b][c],a)});delete o[a.ix]}function w(a){var c={};a.scope=a.scope?[a.scope]:[];a.meta=a.meta||[];h(q(d),function(b){c[b]=function(){d[b].apply(this,a.scope.concat(_.toArray(arguments),a.meta));return c}});return c}function d(a,c){var e=arguments.length,g={};if(e==0)return[b,i];if(_.isObject(a))return h(a,function(a,b){g[b]=d(b,a)}),g;if(e==1)return a.search(/[*?]/)+1?_.select(q(b),
function(b){return b.match(a)}):b[a];g=w({scope:a});_.isFunction(c)?g.when(c):e>1&&g.run(c);return g}var h=_.each,q=_.keys,r=_.extend,p=_.flatten,b=s||{},v=0,o={},l=["test","when","after"],i={},k={};h(l,function(a){i[a]={};d[a]=function(b,e){u(e);h(p([b]),function(b){i[a][b]=(i[a][b]||[]).concat(e);e.refs.push([a,b])});return r(d,{handle:e})}});l.shift();return r(d,{push:function(a,c){b[a]=b[a]||[];b[a].current=b[a].push(c);return j(a,b[a])},pop:function(a){b[a].pop();b[a].current=_.last(b[a]);return j(a,
b[a])},incr:function(a){return j(a,_.isNumber(b[a])?b[a]+1:1)},decr:function(a){return j(a,b[a]-1||0)},once:function(a,b){var e=d.when(a,b);e.handle.rm=!0;return e},isset:function(a,c){if(!(a in b)&&c)return d.once(a,c);c&&c(b[a]);return a in b},firstset:d.isset,run:j,emit:j,get:d,onset:d,set:function(a,b){arguments.length==1&&(b=!0);return d(a,b)},unset:function(a){delete b[a]},remove:m})};
