function EvDa(){function u(a,g,c,d){var f=h[d.stage][a],l;if(f){l=f.length;j(f,function(f,l){d.result[l]=f(g,{meta:c,oldValue:d.oldValue,currentValue:b[a],key:a,deregister:function(){f.once=!0}})});for(ix=0;ix<l;ix++)f[ix].once&&n(f[ix])}}function q(a,g,c){var d=b[a],f={};g!==void 0&&(b[a]=g);j(["invoke","after"],function(b){u(a,g,c,{result:f,stage:b,oldValue:d})});m[a]=!1;return f}function v(a,g,c){function d(b){b=b!==!1;l+=b;e+=!b;if(l+e==f)if(e)m[a]=!1;else return q(a,g,c)}var f=h.test[a].length,
l=0,e=0;j(h.test[a],function(f){f(g,{meta:c,oldValue:b[a],callback:d,key:a,deregister:function(){n(f)}})})}function w(a){a.ix=++x;a.refList=[];return r[a.ix]=a}function k(a,g,b){var d={};_.isString(a)&&(a=[a]);j(a,function(a){var e;m[a]||(m[a]=!0,e=h.test[a]?v(a,g,b):q(a,g,b));d[a]=e});return d}function n(a){a.refList&&j(a.refList,function(b){var c=b[0],b=b[1],d=_.indexOf(h[c][b],a);h[c][b].splice(d,1)});delete r[a.ix]}function s(a){var b={};a.scope=a.scope?[a.scope]:[];if(!a.meta)a.meta=[];j(t(e),
function(c){b[c]=function(){e[c].apply(this,a.scope.concat(o.call(arguments),a.meta));return b}});return b}var i={},j=_.each,t=_.keys,p=_.extend,o=Array.prototype.slice,b={},x=0,r={},h={},m={},e={},e={push:function(a,g){_.isArray(b[a])||(b[a]=[]);b[a].current=b[a].push(g);return k(a,b[a])},pop:function(a){if(_.isArray(b[a]))return b[a].pop(),b[a].current=_.last(b[a]),k(a,b[a])},onSet:function(a,b){return e.invoke(a,b).handle},decr:function(a){return a in b&&_.isNumber(b[a])?k(a,b[a]-1):k(a,0)},incr:function(a){return a in
b&&_.isNumber(b[a])?k(a,b[a]+1):k(a,1)},notNull:function(a,g){if(a in b&&b[a]!==null)g(b[a]);else return e.onSet.once(a,g)},meta:function(a){return s({meta:a})},run:k,share:e.meta,deregister:n};e.onSet.once=function(a,b){var c=e.onSet(a,b);c.once=!0;return c};j(["test","invoke","after"],function(a){h[a]={};e[a]=function(b,c){c&&(c=w(c),_.isString(b)&&(b=[b]),j(b,function(b){h[a][b]||(h[a][b]=[]);h[a][b].push(c);c.refList.push([a,b])}));return p({handle:c},e)}});i.Event=function(a,b){if(arguments.length==
0)return h;var c=s({scope:a});if(_.isFunction(b))c.invoke(b);else if(arguments.length>1)c.run(b);else if(a.constructor==Object){var c={},d;for(d in a)c[d]=i.Event(d,a[d])}return c};i.Data=function(a,e){var c=o.call(arguments),d={},f=[];if(c.length==0)return b;if(typeof a=="object"){for(var h in a)d[h]=i.Data(h,a[h]);return d}if(c.length==1){if(a.search(/[\*\?]/)!=-1){var m=RegExp(a,"ig"),d=[];j(t(b),function(a){a.match(m)&&d.push(a)});return d}if(_.isArray(b[a]))try{_.isFunction(b[a].push)}catch(n){b[a]=
o.call(b[a])}return b[a]}_.isArray(this)&&(f=this);return k.apply(this,c.concat(f))};p(i.Event,e);p(i.Data,e);i.Data.set=i.get=i.set=i.Data;return i};
