function EvDa(){function s(a,c,d,f){var g=h[f.stage][a];i(g,function(g,h){f.result[h]=g(c,{meta:d,oldValue:f.oldValue,currentValue:b[a],key:a,remove:function(){g.rm=!0}})});i(g,function(a){a.rm&&l(a)})}function m(a,c,d){var f=b[a],g={};b[a]=c;i(["during","after"],function(b){s(a,c,d,{result:g,stage:b,oldValue:f})});k[a]=!1;return g}function t(a,c,d){function f(b){g--;e+=b===!1;g||(e||m(a,c,d),k[a]=!1)}var g=h.test[a].length,e=0;i(h.test[a],function(g){g(c,{meta:d,oldValue:b[a],callback:f,key:a,remove:function(){l(g)}})})}
function u(a){a.refList=[];n[a.ix=++v]=a}function j(a,c,d){var b={};i(o([a]),function(a){var e;k[a]||(k[a]=!0,e=h.test[a]?t(a,c,d):m(a,c,d));b[a]=e});return b}function l(a){i(a.refList,function(c){var b=c[0],c=c[1];h[b][c]=_.without(h[b][c],a)});delete n[a.ix]}function p(a){var c={};a.scope=a.scope?[a.scope]:[];a.meta=a.meta||[];i(q(e),function(b){c[b]=function(){e[b].apply(this,a.scope.concat(w.call(arguments),a.meta));return c}});return c}function e(a,c){var d=arguments.length,f={};if(d==0)return[b,
h];if(_.isObject(a))return i(a,function(a,b){f[b]=e(b,a)}),f;if(d==1)return a.search(/[\*\?]/)!=-1?(keyRegex=RegExp(a,"ig"),_.select(q(b),function(a){return a.match(keyRegex)})):b[a];f=p({scope:a});_.isFunction(c)?f.during(c):d>1&&f.run(c);return f}var i=_.each,q=_.keys,r=_.extend,o=_.flatten,w=Array.prototype.slice,b={},v=0,n={},h={},k={};i(["test","during","after"],function(a){h[a]={};e[a]=function(b,d){u(d);i(o([b]),function(b){h[a][b]=(h[a][b]||[]).concat(d);d.refList.push([a,b])});return r({handle:d},
e)}});return r(e,{push:function(a,c){b[a]=b[a]||[];b[a].current=b[a].push(c);return j(a,b[a])},pop:function(a){b[a].pop();b[a].current=_.last(b[a]);return j(a,b[a])},once:function(a,b){var d=e.during(a,b);d.handle.once=!0;return d},decr:function(a){return j(a,b[a]-1||0)},incr:function(a){return j(a,_.isNumber(b[a])?b[a]+1:1)},notNull:function(a,c){if(a in b&&b[a]!==null)c(b[a]);else return e.once(a,c)},share:function(a){return p({meta:a})},run:j,get:e,set:e,remove:l})};
