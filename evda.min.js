function EvDa(){function w(a,e,c,f){var h=g[f.stage][a];j(h,function(h,d){f.result[d]=h(e,{meta:c,oldValue:f.oldValue,currentValue:b[a],key:a,deregister:function(){h.once=!0}})});j(h,function(a){a.once&&m(a)})}function q(a,e,c){var f=b[a],h={};e!==void 0&&(b[a]=e);j(["invoke","after"],function(b){w(a,e,c,{result:h,stage:b,oldValue:f})});l[a]=!1;return h}function x(a,e,c){function f(b){b=b!==!1;h+=b;d+=!b;h+d==g.test[a].length&&(d?l[a]=!1:q(a,e,c))}var h=0,d=0;j(g.test[a],function(h){h(e,{meta:c,oldValue:b[a],
callback:f,key:a,deregister:function(){m(h)}})})}function y(a){a.ix=++z;a.refList=[];return r[a.ix]=a}function k(a,e,b){var f={};s(a)&&(a=[a]);j(a,function(a){var d;l[a]||(l[a]=!0,d=g.test[a]?x(a,e,b):q(a,e,b));f[a]=d});return f}function m(a){a.refList&&j(a.refList,function(e){var b=e[0],e=e[1],f=_.indexOf(g[b][e],a);g[b][e].splice(f,1)});delete r[a.ix]}function t(a){var b={};a.scope=a.scope?[a.scope]:[];if(!a.meta)a.meta=[];j(u(d),function(c){b[c]=function(){d[c].apply(this,a.scope.concat(o.call(arguments),
a.meta));return b}});return b}var i={},j=_.each,u=_.keys,p=_.extend,v=_.isFunction,n=_.isArray,s=_.isString,A=_.isNumber,o=Array.prototype.slice,b={},z=0,r={},g={},l={},d={},d={push:function(a,e){n(b[a])||(b[a]=[]);b[a].current=b[a].push(e);return k(a,b[a])},pop:function(a){if(n(b[a]))return b[a].pop(),b[a].current=_.last(b[a]),k(a,b[a])},onSet:function(a,b){return d.invoke(a,b).handle},decr:function(a){return k(a,b[a]-1||0)},incr:function(a){return a in b&&A(b[a])?k(a,b[a]+1):k(a,1)},notNull:function(a,
e){if(a in b&&b[a]!==null)e(b[a]);else return d.onSet.once(a,e)},meta:function(a){return t({meta:a})},run:k,share:d.meta,deregister:m};d.onSet.once=function(a,b){var c=d.onSet(a,b);c.once=!0;return c};j(["test","invoke","after"],function(a){g[a]={};d[a]=function(b,c){c&&(c=y(c),s(b)&&(b=[b]),j(b,function(b){g[a][b]||(g[a][b]=[]);g[a][b].push(c);c.refList.push([a,b])}));return p({handle:c},d)}});i.Event=function(a,b){if(arguments.length==0)return g;var c=t({scope:a});if(v(b))c.invoke(b);else if(arguments.length>
1)c.run(b);else if(a.constructor==Object){var c={},f;for(f in a)c[f]=i.Event(f,a[f])}return c};i.Data=function(a,e){var c=o.call(arguments),f={},d=[];if(c.length==0)return b;if(typeof a=="object"){for(var g in a)f[g]=i.Data(g,a[g]);return f}if(c.length==1){if(a.search(/[\*\?]/)!=-1){var l=RegExp(a,"ig"),f=[];j(u(b),function(a){a.match(l)&&f.push(a)});return f}if(n(b[a]))try{v(b[a].push)}catch(m){b[a]=o.call(b[a])}return b[a]}n(this)&&(d=this);return k.apply(this,c.concat(d))};p(i.Event,d);p(i.Data,
d);i.Data.set=i.get=i.set=i.Data;return i};
