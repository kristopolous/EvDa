function EvDa(w){function d(a,b,c){if(1==arguments.length){if(o(a)&&!(""===a||a&&a.charCodeAt&&a.substr)){var g={};f(a,function(a,b){g[a]=d(a,b,c,0,1)});f(g,function(b,c){l(g[c])&&!l(a[c])&&(a[c]=g[c]())});return a}return n(a)?x(a,function(a){return d(a,b,c)}):e[a]}return d[l(b)?p:"set"].apply(this,arguments)}function u(a){f(a.$,function(b){h[b]=v(h[b],a)})}function i(a,b){if(o(a))return f(a,function(b,g){a[g]=i(g,b)}),a;j[a]&&(j[a](),j[a]=0);return b?a in e?b(e[a]):d(a,b,y):a in e}var k=Array.prototype.slice,
m=Object.prototype.toString,n=[].isArray||function(a){return"[object Array]"===m.call(a)},l=function(a){return!(!a||!a.constructor||!a.call||!a.apply)},o=function(a){return""===a||a&&a.charCodeAt&&a.substr?!1:null==a?"object"==""+a:"[object Object]"===m.call(a)||!0},f=[].forEach?function(a,b){if(n(a)||a.length)k.call(a).forEach(b);else for(var c in a)b(c,a[c])}:function(a,b){if(n(a))for(var c=0,g=a.length;c<g;c++)b(a[c],c);else for(c in a)b(c,a[c])},q={}.keys||function(a){if(n(a))return a;var b=[],
c;for(c in a)b.push(c);return b},v=function(a,b){var c=[];f(a,function(a){a!==b&&c.push(a)});return c},z=function(a){var b,c=[];f(q(a).sort(),function(a){a!=b&&(b=a,c.push(a))});return c},A=function(a,b){var c=[];f(a,function(a){b(a)&&c.push(a)});return c},r=function(a){return a&&"length"in a?a.length:0},x=[].map?function(a,b){return a.map(b)}:function(a,b){for(var c=[],d=0,e=obj.length;d<e;d++)c.push(b(obj[d],d));return c},s=function(a){f(k.call(arguments,1),function(b){for(var c in b)void 0!==b[c]&&
(a[c]=b[c])});return a},p="on",y={once:1},e=w||{},j={},h={};f([p,"after","test"],function(a){d[a]=function(b,c,d){if(1==arguments.length)c=b,b=EvDa._BASE_;(c.$||(c.$=[])).push(a+b);(h[a+b]||(h[a+b]=[])).push(c);return s(c,d)}});s(d,{list:{},db:e,events:h,del:u,isset:i,setter:function(a,b){j[a]=b;h["on"+a]&&i(a)},incr:function(a){return d.set(a,"[object Number]"===m.call(e[a])?e[a]+1:1)},decr:function(a){return d.set(a,e[a]-1||0)},push:function(a,b){if(1==r(arguments))b=a,a=EvDa._BASE_;return d.set(a,
[].concat(e[a]||[],[b]))},pop:function(a){if(1==arguments.length)a=EvDa._BASE_;return d.set(a,e[a].slice(0,-1))},group:function(a){var b=k.call(arguments),a=b.shift(),b=d.apply(0,b);d.list[a]||(d.list[a]=[]);l(b)?d.list[a].push(b):f(b,function(b){d.list[a].push(b)});return function(){return d.group.apply(0,[a].concat(k.call(arguments)))}},set:function(a,b,c,g,l){var t="test"+a,j=r(h[t]),i,m={meta:c||{},old:n(e[a])?k.call(e[a]):o(e[a])?s(e[a],{}):e[a],key:a,done:function(e){i|=!1===e;--j||i||d.set(a,
b,c,1)}};if(j&&!g)f(h[t],function(a){a(b,m)});else return e[a]=b,g=function(){f((h[p+a]||[]).concat(h["after"+a]||[]),function(a){a.S||(a(b,m),a.once&&u(a))});return b},l?g:g();return b},once:function(a,b){return d(a,b,{once:!0})},enable:function(a){f(d.list[a],function(b){b.S&&b.S[a]&&delete b.S[a];0==r(b.S)&&delete b.S})},setadd:function(a,b){return d(a,z((e[a]||[]).concat([b])))},setdel:function(a,b){return d(a,v(e[a]||[],b))},disable:function(a){f(d.list[a],function(b){(b.S||(b.S={}))[a]=!0})},
unset:function(){f(arguments,function(a){delete e[a]})},find:function(a){return A(q(e),function(b){return b.match(a)})},added:function(a,b){if(1==arguments.length)b=a,a=EvDa._BASE_;d.on(a,function(a,d){var e=k.call(a).length,f=d.old?d.old.length:0;1==e-f?b(a.length?a[a.length-1]:void 0):e>f&&b(k.call(a).slice(f))})},sniff:function(){d.set_=d.set;var a={};d.set=function(){var b=Array.prototype.slice.call(arguments);a[b[0]]||console.log(+new Date,b);d.set_.apply(this,b)};d.sniff=function(b){if(b)return a[b]=
!a[b],"[Un]ignoring "+b;console.log(q(a))}}});d.change=d.on;d.add=d.push;return d}EvDa._BASE_="_base_"+Math.random().toString().substr(2);
