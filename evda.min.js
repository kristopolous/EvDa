function EvDa(){function w(a,e,c,j){var f=h[j.stage][a];g(f,function(f,g){j.result[g]=f(e,{meta:c,oldValue:j.oldValue,currentValue:b[a],key:a,deregister:function(){f.once=!0}})});g(f,function(a){a.once&&n(a)})}function q(a,e,c){var j=b[a],f={};e!==void 0&&(b[a]=e);g(["invoke","after"],function(b){w(a,e,c,{result:f,stage:b,oldValue:j})});l[a]=!1;return f}function x(a,e,c){function j(b){b=b!==!1;f+=b;d+=!b;f+d==h.test[a].length&&(d?l[a]=!1:q(a,e,c))}var f=0,d=0;g(h.test[a],function(f){f(e,{meta:c,oldValue:b[a],
callback:j,key:a,deregister:function(){n(f)}})})}function y(a){a.ix=++z;a.refList=[];return r[a.ix]=a}function k(a,e,c){var b={};s(a)&&(a=[a]);g(a,function(a){var d;l[a]||(l[a]=!0,d=h.test[a]?x(a,e,c):q(a,e,c));b[a]=d});return b}function n(a){a.refList&&g(a.refList,function(e){var b=e[0],e=e[1];h[b][e]=_.without(h[b][e],a)});delete r[a.ix]}function t(a){var b={};a.scope=a.scope?[a.scope]:[];if(!a.meta)a.meta=[];g(u(d),function(c){b[c]=function(){d[c].apply(this,a.scope.concat(o.call(arguments),a.meta));
return b}});return b}var i={},g=_.each,u=_.keys,p=_.extend,v=_.isFunction,m=_.isArray,s=_.isString,A=_.isNumber,o=Array.prototype.slice,b={},z=0,r={},h={},l={},d={},d={push:function(a,e){m(b[a])||(b[a]=[]);b[a].current=b[a].push(e);return k(a,b[a])},pop:function(a){if(m(b[a]))return b[a].pop(),b[a].current=_.last(b[a]),k(a,b[a])},onSet:function(a,b){return d.invoke(a,b).handle},decr:function(a){return k(a,b[a]-1||0)},incr:function(a){return k(a,A(b[a])?b[a]+1:1)},notNull:function(a,e){if(a in b&&
b[a]!==null)e(b[a]);else return d.onSet.once(a,e)},meta:function(a){return t({meta:a})},run:k,share:d.meta,deregister:n};d.onSet.once=function(a,b){var c=d.onSet(a,b);c.once=!0;return c};g(["test","invoke","after"],function(a){h[a]={};d[a]=function(b,c){c&&(c=y(c),s(b)&&(b=[b]),g(b,function(b){h[a][b]||(h[a][b]=[]);h[a][b].push(c);c.refList.push([a,b])}));return p({handle:c},d)}});i.Event=function(a,b){if(arguments.length==0)return h;var c=t({scope:a});v(b)?c.invoke(b):arguments.length>1?c.run(b):
a.constructor==Object&&(c={},g(a,function(b){c[b]=i.Event(b,a[b])}));return c};i.Data=function(a,e){var c=o.call(arguments),d={},f=[];if(c.length==0)return b;if(typeof a=="object")return g(a,function(b){d[b]=i.Data(b,a[b])}),d;if(c.length==1){if(a.search(/[\*\?]/)!=-1){var h=RegExp(a,"ig"),d=[];g(u(b),function(a){a.match(h)&&d.push(a)});return d}if(m(b[a]))try{v(b[a].push)}catch(l){b[a]=o.call(b[a])}return b[a]}m(this)&&(f=this);return k.apply(this,c.concat(f))};p(i.Event,d);p(i.Data,d);i.Data.set=
i.get=i.set=i.Data;return i};
