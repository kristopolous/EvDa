function EvDa(){function o(a,d,t,f){var c=g[f.stage][a],i;if(!c)return f.result;i=c.length;j(c,function(c,h){f.result[h]=c(d,{meta:t,oldValue:f.oldValue,currentValue:b[a],key:a,deregister:function(){c.oneShot=!0}})});for(ix=0;ix<i;ix++)c[ix].oneShot&&l(c[ix])}function p(a,d,c){var f=b[a],h={};d!==void 0&&(b[a]=d);o(a,d,c,{result:h,stage:"invoke",oldValue:f});o(a,d,c,{result:h,stage:"after",oldValue:f});delete k[a];return h}function u(a,d,c){function f(b){arguments.length==0&&(b=!0);i+=b;e+=!b;if(i+
e==h)if(e)k[a]=!1;else return p(a,d,c)}var h=g.test[a].length,i=0,e=0;j(g.test[a],function(h){h(d,{meta:c,oldValue:b[a],callback:f,key:a,deregister:function(){l(h)}})})}function v(a){a.ix=++w;a.refList=[];return q[a.ix]=a}function l(a){a.refList&&j(a.refList,function(d){var c=d[0],d=d[1],b=_.indexOf(g[c][d],a);g[c][d].splice(b,1)});delete q[a.ix]}function r(a){var d={};a.scope=a.scope?[a.scope]:[];if(!a.meta)a.meta=[];j(s(c),function(b){d[b]=function(){c[b].apply(this,a.scope.concat(m.call(arguments),
a.meta));return d}});return d}var e={},j=_.each,s=_.keys,n=_.extend,m=Array.prototype.slice,b={},w=0,q={},g={},k={},c={},c={ifChanged:function(a,d){return!(a in b)?c.run(a,d):b[a]!==d?c.run(a,d):!1},pop:function(a){if(!_.isArray(b[a]))return!1;b[a].pop();b[a].current=b[a].length>0?b[a][b[a].length-1]:void 0;return c.run(a,b[a])},append:function(a,d){_.isArray(b[a])||(b[a]=[]);b[a].push(d);b[a].current=d;return c.run(a,b[a])},onSet:function(a,d){return c.invoke(a,d).handle},decr:function(a){return a in
b&&_.isNumber(b[a])?c.run(a,b[a]-1):c.run(a,0)},incr:function(a){return a in b&&_.isNumber(b[a])?c.run(a,b[a]+1):c.run(a,1)},run:function(a,d,b){var c={};_.isString(a)&&(a=[a]);j(a,function(a){var e;e={};k[a]?e={}:(k[a]=!0,e=g.test[a]?u(a,d,b):p(a,d,b));c[a]=e});return c},notNull:function(a,d){if(a in b&&b[a]!==null)d(b[a]);else return c.onSet.once(a,d)},meta:function(a){return r({meta:a})},deregister:l};c.push=c.append;c.share=c.meta;c.onSet.once=function(a,b){var e=c.onSet(a,b);e.oneShot=!0;return e};
j(["test","invoke","after"],function(a){g[a]={};c[a]=function(b,e){e&&(e=v(e),_.isString(b)&&(b=[b]),j(b,function(b){g[a][b]||(g[a][b]=[]);g[a][b].push(e);e.refList.push([a,b])}));return n({handle:e},c)}});e.Event=function(a,b){if(arguments.length==0)return g;var c=r({scope:a});if(_.isFunction(b))c.invoke(b);else if(arguments.length>1)c.run(b);else if(arguments[0].constructor==Object){var c={},f;for(f in arguments[0])c[f]=e.Event(f,arguments[0][f])}return c};e.Data=function(a,d){var g=m.call(arguments),
f={},h=[];if(arguments.length===0)return b;if(typeof a==="object"){for(var i in a)f[i]=e.Data.apply(this,[i,a[i]]);return f}if(arguments.length==1){if(a.search(/[\*\?]/)!=-1){var k=RegExp(a,"ig"),f=[];j(s(b),function(a){a.match(k)&&f.push(a)});return f}if(_.isArray(b[a]))try{_.isFunction(b[a].push)}catch(l){b[a]=m.call(b[a])}return b[a]}this.constructor==Array&&(h=this);return c.run.apply(this,g.concat(h))};n(e.Event,c);n(e.Data,c);c.set=e.Data.set=e.get=e.set=e.Data;return e};
