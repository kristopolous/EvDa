function EvDa(A){function c(a,b,q){if(l(a))return B(a,function(a){return c.call(c.context,a,b,q)});if(1==arguments.length){if(v(a)){var f={};e(a,function(a,b){f[a]=c(a,b,q,0,1)});e(f,function(b,q){m(f[b])&&!m(a[b])&&(a[b]=f[b]())});return a}return d[a]}return c[m(b)?t:"set"].apply(this,arguments)}function y(a){e(a.$,function(b){g[b]=z(g[b],a)})}function n(a,b){if(l(a))return n(a.pop(),function(){return n(1==a.length?a[0]:a,b)});if(v(a))return e(a,function(b,c){a[b]=n(b,c)}),a;k[a]&&(k[a](function(b){c.set.call(c.context,
a,b)}),delete k[a]);return b?a in d?b.call(c.context,d[a]):c(a,b,D):a in d}var p=Array.prototype.slice,w=Object.prototype.toString,l=[].isArray||function(a){return"[object Array]"===w.call(a)},m=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},v=function(a){return""===a||a&&a.charCodeAt&&a.substr?!1:null==a?"object"==String(a):"[object Object]"===w.call(a)||!0},e=[].forEach?function(a,b){if(l(a)||a.length)p.call(a).forEach(b);else for(var c in a)b(c,a[c])}:function(a,b){if(l(a))for(var c=
0,f=a.length;c<f;c++)b(a[c],c);else for(c in a)b(c,a[c])},x={}.keys||function(a){if(l(a))return a;var b=[],c;for(c in a)b.push(c);return b},z=function(a,b){var c=[];e(a,function(a){a!==b&&c.push(a)});return c},E=function(a){var b,c=[];e(x(a).sort(),function(a){a!=b&&(b=a,c.push(a))});return c},F=function(a,b){var c=[];e(a,function(a){b(a)&&c.push(a)});return c},s=function(a){return a&&"length"in a?a.length:0},B=[].map?function(a,b){return a.map(b)}:function(a,b){for(var c=[],f=0,d=a.length;f<d;f++)c.push(b(a[f],
f));return c},u=function(a){e(p.call(arguments,1),function(b){for(var c in b)void 0!==b[c]&&(a[c]=b[c])});return a},t="on",D={once:1},d=A||{},k={},g={};e([t,"after","test"],function(a){c[a]=function(b,c,f){c||(c=b,b="__base");(c.$||(c.$=[])).push(a+b);(g[a+b]||(g[a+b]=[])).push(c);return u(c,f)}});u(c,{context:this,list:{},db:d,setterMap:k,events:g,del:y,whenSet:n,isset:n,setter:function(a,b){k[a]=b;if(g[t+a])return n(a)},when:function(a,b,d){return c(a,function(a){(l(b)&&b.sort().join("")===a.sort().join("")||
m(b)&&b(a)||a===b)&&d.call(c.context,a)})},incr:function(a){return c.set(a,"[object Number]"===w.call(d[a])?d[a]+1:1)},decr:function(a){return c.set(a,d[a]-1||0)},push:function(a,b){1==s(arguments)&&(b=a,a="__base");return c.set(a,[].concat(d[a]||[],[b]))},pop:function(a){return c.set(a||"__base",d[a].slice(0,-1))},traceList:[],group:function(a){var b=p.call(arguments);a=b.shift();b=c.apply(0,b);c.list[a]||(c.list[a]=[]);m(b)?c.list[a].push(b):e(b,function(b,d){c.list[a].push(b)});return function(){return c.group.apply(0,
[a].concat(p.call(arguments)))}},set:function(a,b,q,f,C){var h="test"+a,n=p.call(arguments),m=s(g[h]),k,r=function(d){k|=!1===d;--m||k||c.set(a,b,q,1)};r.old=l(d[a])?p.call(d[a]):v(d[a])?u(d[a],{}):d[a];u(r,{meta:q||{},done:r,result:r,key:a});e(c.traceList,function(a){a.call(c.context,n)});if(m&&!f)e(g[h],function(a){a.call(c.context,b,r)});else return d[a]=b,h=function(){e((g[t+a]||[]).concat(g["after"+a]||[]),function(a){a.S||(a.call(c.context,b,r),a.once&&y(a))});return b},C?h:h.call(c.context);
return d[a]},once:function(a,b){return c(a,b,{once:!0})},enable:function(a){e(c.list[a],function(b){b.S&&b.S[a]&&delete b.S[a];0==s(b.S)&&delete b.S});return c.list[a]},setadd:function(a,b){return c(a,E((d[a]||[]).concat([b])))},setdel:function(a,b){return c(a,z(d[a]||[],b))},disable:function(a){e(c.list[a],function(b){(b.S||(b.S={}))[a]=!0});return c.list[a]},unset:function(){var a=!0;e(arguments,function(b){a&=b in d;delete d[b]});return a},find:function(a){return F(x(d),function(b){return b.match(a)})},
changed:function(a,b){b||(b=a,a="__base");return c.on(a,function(a,d){var e=s(a),h=s(d.old);1==e-h?b.call(c.context,a.length?a[a.length-1]:void 0):e>h&&b.call(c.context,p.call(a).slice(h))})},sniff:function(){var a={},b=+new Date,d=function(c){a[c[0]]||console.log(+new Date-b,c)},e=function(){},g=d;c.traceList.unshift(function(a){g(a)});c.sniff=function(b){if(0<arguments.length){if(""===b||b&&b.charCodeAt&&b.substr)return a[b]=!a[b],"[Un]ignoring "+b;g=b?d:e;return b}return x(a)}}});c.setAdd=c.setadd;
c.setDel=c.setdel;c.isSet=c.isset;c.get=c;c.change=c.on;c.add=c.push;c.isArray=l;return c};
