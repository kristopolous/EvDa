function EvDa(u){function p(a,b,c){i("set",a,b);var j=d[a],f,e={};d[a]=b;g(m,function(d){f=h[d][a];g(f,function(f,d){e[d]=f(b,{meta:c,old:j,current:b,key:a,remove:function(){f.rm=1}})});g(f,function(a){a.rm&&n(a)})});k[a]=0;return e}function v(a,b,c){function e(d){f--;q+=d===!1;f||(q||p(a,b,c),k[a]=0)}var f=h.test[a].length,q=0;g(h.test[a],function(f){f(b,{meta:c,old:d[a],callback:e,key:a,remove:function(){n(f)}})})}function w(a){a.refs=[];o[a.ix=++x]=a}function n(a){g(a.refs,function(b){var c=b[0],
b=b[1];h[c][b]=_.without(h[c][b],a)});delete o[a.ix]}function y(a){var b={};g(r(e),function(c){b[c]=function(){e[c].apply(this,[a].concat(_.toArray(arguments)));return b}});return b}function e(a,b){var c=arguments.length,j={};if(c==0)return{data:d,events:h,functions:o};return c==1?_.isObject(a)?(g(a,function(a,b){j[b]=e(b,a)}),j):a.search(/[*?]/)+1?_.select(r(d),function(b){return b.match(a)}):d[a]:y(a)[_.isFunction(b)?"when":"run"](b)}var g=_.each,r=_.keys,s=_.extend,t=_.flatten,d=u||{},i=function(){},
l={},x=0,o={},m=["test","when","after"],h={},k={};g(m,function(a){h[a]={};e[a]=function(b,c){w(c);g(t([b]),function(b){i("reg",a,b);h[a][b]=(h[a][b]||[]).concat(c);c.refs.push([a,b])});return s(e,{info:c})}});m.shift();return s(e,{once:function(a,b){var c=e.when(a,b);c.info.rm=1;return c},setter:function(a,b){l[a]=b;a in d&&e.isset(a)},isset:function(a,b){l[a]&&(i("setter",a),l[a](),delete l[a]);return b?a in d?b(d[a]):e.once(a,b):a in d},firstset:e.isset,run:function(a,b,c){var d={};g(t([a]),function(a){k[a]||
(k[a]=1,d[a]=h.test[a]?v(a,b,c):p(a,b,c))});return d},on:e,set:function(a,b){return e(a,arguments.length==1?1:b)},unset:function(a){delete d[a]},debug:function(){i=console.log},remove:n})};
