function EvDa(){function s(a,c,d,e){var g=h[e.stage][a];i(g,function(g,h){e.result[h]=g(c,{meta:d,oldValue:e.oldValue,currentValue:b[a],key:a,deregister:function(){g.rm=!0}})});i(g,function(a){a.rm&&l(a)})}function m(a,c,d){var e=b[a],g={};b[a]=c;i(["during","after"],function(b){s(a,c,d,{result:g,stage:b,oldValue:e})});k[a]=!1;return g}function t(a,c,d){function e(b){b=b!==!1;g+=b;f+=!b;g+f==h.test[a].length&&(f||m(a,c,d),k[a]=!1)}var g=0,f=0;i(h.test[a],function(g){g(c,{meta:d,oldValue:b[a],callback:e,
key:a,deregister:function(){l(g)}})})}function u(a){a.refList=[];n[a.ix=++v]=a}function j(a,c,b){var e={};i(o([a]),function(a){var f;k[a]||(k[a]=!0,f=h.test[a]?t(a,c,b):m(a,c,b));e[a]=f});return e}function l(a){i(a.refList,function(c){var b=c[0],c=c[1];h[b][c]=_.without(h[b][c],a)});delete n[a.ix]}function p(a){var b={};a.scope=a.scope?[a.scope]:[];a.meta=a.meta||[];i(q(f),function(d){b[d]=function(){f[d].apply(this,a.scope.concat(w.call(arguments),a.meta));return b}});return b}function f(a,c){var d=
arguments.length,e={};if(d==0)return[b,h];if(x(a))return i(a,function(a,b){e[b]=f(b,a)}),e;if(d==1)return a.search(/[\*\?]/)!=-1?(keyRegex=RegExp(a,"ig"),_.select(q(b),function(a){return a.match(keyRegex)})):b[a];e=p({scope:a});y(c)?e.during(c):d>1&&e.run(c);return e}var i=_.each,q=_.keys,r=_.extend,o=_.flatten,y=_.isFunction,z=_.isNumber,x=_.isObject,w=Array.prototype.slice,b={},v=0,n={},h={},k={};i(["test","during","after"],function(a){h[a]={};f[a]=function(b,d){u(d);i(o([b]),function(b){h[a][b]=
(h[a][b]||[]).concat(d);d.refList.push([a,b])});return r({handle:d},f)}});return r(f,{push:function(a,c){b[a]=b[a]||[];b[a].current=b[a].push(c);return j(a,b[a])},pop:function(a){b[a].pop();b[a].current=_.last(b[a]);return j(a,b[a])},once:function(a,b){var d=f.during(a,b);d.handle.once=!0;return d},decr:function(a){return j(a,b[a]-1||0)},incr:function(a){return j(a,z(b[a])?b[a]+1:1)},notNull:function(a,c){if(a in b&&b[a]!==null)c(b[a]);else return f.once(a,c)},share:function(a){return p({meta:a})},
run:j,get:f,set:f,deregister:l})};
