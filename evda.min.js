function EvDa(){function q(a,c,d,e){var g=h[e.stage][a],l;if(!g)return e.result;l=g.length;k(g,function(g,l){e.result[l]=g(c,{meta:d,oldValue:e.oldValue,currentValue:b[a],key:a,deregister:function(){g.oneShot=!0}})});for(ix=0;ix<l;ix++)g[ix].oneShot&&n(g[ix])}function r(a,c,d){var e=b[a],g={};c!==void 0&&(b[a]=c);q(a,c,d,{result:g,stage:"invoke",oldValue:e});q(a,c,d,{result:g,stage:"after",oldValue:e});delete m[a];return g}function v(a,c,d){function e(b){arguments.length==0&&(b=!0);l+=b;f+=!b;if(l+
f==g)if(f)m[a]=!1;else return r(a,c,d)}var g=h.test[a].length,l=0,f=0;k(h.test[a],function(g){g(c,{meta:d,oldValue:b[a],callback:e,key:a,deregister:function(){n(g)}})})}function w(a){a.ix=++x;a.refList=[];return s[a.ix]=a}function j(a,c,b){var e={};_.isString(a)&&(a=[a]);k(a,function(a){var f;f={};m[a]?f={}:(m[a]=!0,f=h.test[a]?v(a,c,b):r(a,c,b));e[a]=f});return e}function n(a){a.refList&&k(a.refList,function(c){var b=c[0],c=c[1],e=_.indexOf(h[b][c],a);h[b][c].splice(e,1)});delete s[a.ix]}function t(a){var c=
{};a.scope=a.scope?[a.scope]:[];if(!a.meta)a.meta=[];k(u(f),function(b){c[b]=function(){f[b].apply(this,a.scope.concat(o.call(arguments),a.meta));return c}});return c}var i={},k=_.each,u=_.keys,p=_.extend,o=Array.prototype.slice,b={},x=0,s={},h={},m={},f={},f={push:function(a,c){_.isArray(b[a])||(b[a]=[]);b[a].push(c);b[a].current=c;return j(a,b[a])},pop:function(a){if(!_.isArray(b[a]))return!1;b[a].pop();b[a].current=b[a].length>0?b[a][b[a].length-1]:void 0;return j(a,b[a])},onSet:function(a,b){return f.invoke(a,
b).handle},ifChanged:function(a,c){return!(a in b)?j(a,c):b[a]!==c?j(a,c):!1},decr:function(a){return a in b&&_.isNumber(b[a])?j(a,b[a]-1):j(a,0)},incr:function(a){return a in b&&_.isNumber(b[a])?j(a,b[a]+1):j(a,1)},notNull:function(a,c){if(a in b&&b[a]!==null)c(b[a]);else return f.onSet.once(a,c)},meta:function(a){return t({meta:a})},run:j,share:f.meta,deregister:n};f.onSet.once=function(a,b){var d=f.onSet(a,b);d.oneShot=!0;return d};k(["test","invoke","after"],function(a){h[a]={};f[a]=function(b,
d){d&&(d=w(d),_.isString(b)&&(b=[b]),k(b,function(b){h[a][b]||(h[a][b]=[]);h[a][b].push(d);d.refList.push([a,b])}));return p({handle:d},f)}});i.Event=function(a,b){if(arguments.length==0)return h;var d=t({scope:a});if(_.isFunction(b))d.invoke(b);else if(arguments.length>1)d.run(b);else if(arguments[0].constructor==Object){var d={},e;for(e in arguments[0])d[e]=i.Event(e,arguments[0][e])}return d};i.Data=function(a,c){var d=o.call(arguments),e={},f=[];if(arguments.length===0)return b;if(typeof a===
"object"){for(var h in a)e[h]=i.Data.apply(this,[h,a[h]]);return e}if(arguments.length==1){if(a.search(/[\*\?]/)!=-1){var m=RegExp(a,"ig"),e=[];k(u(b),function(a){a.match(m)&&e.push(a)});return e}if(_.isArray(b[a]))try{_.isFunction(b[a].push)}catch(n){b[a]=o.call(b[a])}return b[a]}this.constructor==Array&&(f=this);return j.apply(this,d.concat(f))};p(i.Event,f);p(i.Data,f);i.Data.set=i.get=i.set=i.Data;return i};
