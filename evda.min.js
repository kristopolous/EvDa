function EvDa(w){function c(a,b,d){if(1==arguments.length){if(s(a)){var j={};f(a,function(a,b){j[a]=c(a,b,d,0,1)});f(j,function(b){k(j[b])&&!k(a[b])&&(a[b]=j[b]())});return a}return p(a)?x(a,function(a){return c(a,b,d)}):e[a]}return c[k(b)?r:"set"].apply(this,arguments)}function u(a){f(a.$,function(b){g[b]=v(g[b],a)})}function l(a,b){if(s(a))return f(a,function(b,c){a[b]=l(b,c)}),a;m[a]&&(m[a](),m[a]=0);return b?a in e?b(e[a]):c(a,b,y):a in e}var h=Array.prototype.slice,i=Object.prototype.toString,
p=[].isArray||function(a){return"[object Array]"===i.call(a)},k=function(a){return!(!a||!a.constructor||!a.call||!a.apply)},s=function(a){return""===a||a&&a.charCodeAt&&a.substr?!1:null==a?"object"==""+a:"[object Object]"===i.call(a)||!0},f=[].forEach?function(a,b){if(p(a)||a.length)h.call(a).forEach(b);else for(var d in a)b(d,a[d])}:function(a,b){if(p(a))for(var d=0,c=a.length;d<c;d++)b(a[d],d);else for(d in a)b(d,a[d])},n={}.keys||function(a){if(p(a))return a;var b=[],d;for(d in a)b.push(d);return b},
v=function(a,b){var d=[];f(a,function(a){a!==b&&d.push(a)});return d},z=function(a){var b,d=[];f(n(a).sort(),function(a){a!=b&&(b=a,d.push(a))});return d},A=function(a,b){var d=[];f(a,function(a){b(a)&&d.push(a)});return d},q=function(a){return a&&"length"in a?a.length:0},x=[].map?function(a,b){return a.map(b)}:function(a,b){for(var d=[],c=0,e=a.length;c<e;c++)d.push(b(a[c],c));return d},t=function(a){f(h.call(arguments,1),function(b){for(var d in b)void 0!==b[d]&&(a[d]=b[d])});return a},r="on",y=
{once:1},e=w||{},m={},g={};f([r,"after","test"],function(a){c[a]=function(b,d,c){d||(d=b,b="__base");(d.$||(d.$=[])).push(a+b);(g[a+b]||(g[a+b]=[])).push(d);return t(d,c)}});t(c,{list:{},db:e,events:g,del:u,isset:l,setter:function(a,b){m[a]=b;g[r+a]&&l(a)},incr:function(a){return c.set(a,"[object Number]"===i.call(e[a])?e[a]+1:1)},decr:function(a){return c.set(a,e[a]-1||0)},push:function(a,b){1==q(arguments)&&(b=a,a="__base");return c.set(a,[].concat(e[a]||[],[b]))},pop:function(a){return c.set(a||
"__base",e[a].slice(0,-1))},traceList:[],group:function(a){var b=h.call(arguments),a=b.shift(),b=c.apply(0,b);c.list[a]||(c.list[a]=[]);k(b)?c.list[a].push(b):f(b,function(b){c.list[a].push(b)});return function(){return c.group.apply(0,[a].concat(h.call(arguments)))}},set:function(a,b,d,j,k){var o="test"+a,m=h.call(arguments),l=q(g[o]),i,n={meta:d||{},old:p(e[a])?h.call(e[a]):s(e[a])?t(e[a],{}):e[a],key:a,done:function(e){i|=!1===e;--l||i||c.set(a,b,d,1)}};f(c.traceList,function(a){a(m)});if(l&&!j)f(g[o],
function(a){a(b,n)});else return e[a]=b,o=function(){f((g[r+a]||[]).concat(g["after"+a]||[]),function(a){a.S||(a(b,n),a.once&&u(a))});return b},k?o:o();return b},once:function(a,b){return c(a,b,{once:!0})},enable:function(a){f(c.list[a],function(b){b.S&&b.S[a]&&delete b.S[a];0==q(b.S)&&delete b.S})},setadd:function(a,b){return c(a,z((e[a]||[]).concat([b])))},setdel:function(a,b){return c(a,v(e[a]||[],b))},disable:function(a){f(c.list[a],function(b){(b.S||(b.S={}))[a]=!0})},unset:function(){f(arguments,
function(a){delete e[a]})},find:function(a){return A(n(e),function(b){return b.match(a)})},added:function(a,b){b||(b=a,a="__base");c.on(a,function(a,c){var e=q(a),f=q(c.old);e-f==1?b(a.length?a[a.length-1]:void 0):e>f&&b(h.call(a).slice(f))})},sniff:function(){c.set_=c.set;var a={};c.set=function(){var b=Array.prototype.slice.call(arguments);a[b[0]]||console.log(+new Date,b);c.set_.apply(this,b)};c.sniff=function(b){if(b)return a[b]=!a[b],"[Un]ignoring "+b;console.log(n(a))}}});c.change=c.on;c.add=
c.push;return c};
