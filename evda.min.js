function EvDa(t){function o(a,b,c){var i=e[a],f,d={};e[a]=b;g(l,function(e){f=h[e][a];g(f,function(f,e){d[e]=f(b,{meta:c,old:i,current:b,key:a,remove:function(){f.rm=1}})});g(f,function(a){a.rm&&m(a)})});j[a]=0;return d}function u(a,b,c){function d(e){f--;p+=e===!1;f||(p||o(a,b,c),j[a]=0)}var f=h.test[a].length,p=0;g(h.test[a],function(f){f(b,{meta:c,old:e[a],callback:d,key:a,remove:function(){m(f)}})})}function v(a){a.refs=[];n[a.ix=++w]=a}function m(a){g(a.refs,function(b){var c=b[0],b=b[1];h[c][b]=
_.without(h[c][b],a)});delete n[a.ix]}function x(a){var b={};g(q(d),function(c){b[c]=function(){d[c].apply(this,[a].concat(_.toArray(arguments)));return b}});return b}function d(a,b){var c=arguments.length,i={};if(c==0)return{data:e,events:h,functions:n};return c==1?_.isObject(a)?(g(a,function(a,b){i[b]=d(b,a)}),i):a.search(/[*?]/)+1?_.select(q(e),function(b){return b.match(a)}):e[a]:x(a)[_.isFunction(b)?"when":"run"](b)}var g=_.each,q=_.keys,r=_.extend,s=_.flatten,e=t||{},k={},w=0,n={},l=["test",
"when","after"],h={},j={};g(l,function(a){h[a]={};d[a]=function(b,c){v(c);g(s([b]),function(b){h[a][b]=(h[a][b]||[]).concat(c);c.refs.push([a,b])});return r(d,{info:c})}});l.shift();return r(d,{once:function(a,b){var c=d.when(a,b);c.info.rm=1;return c},setter:function(a,b){k[a]=b;d.isset(a)},isset:function(a,b){k[a]&&(k[a](),delete k[a]);return b?a in e?b(e[a]):d.once(a,b):a in e},firstset:d.isset,run:function(a,b,c){var d={};g(s([a]),function(a){j[a]||(j[a]=1,d[a]=h.test[a]?u(a,b,c):o(a,b,c))});
return d},on:d,set:function(a,b){return d(a,arguments.length==1?1:b)},unset:function(a){delete e[a]},remove:m})};
