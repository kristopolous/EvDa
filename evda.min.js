function EvDa(H){function I(a,b){return a.match(/[?*]/)?D(v(b?b:d),function(b){return b.match(a)}):a}function E(a,b){var f={};return g(a)?(e(a,function(c){f[a]=b(a)}),f):b(a)}function c(a,b,f){if(!a)return{data:d,setters:m,events:k,globs:x};if(g(a)){var h=n.call(arguments,1);return J(a,function(a){return c.apply(c.context,[a].concat(h))})}if(1==arguments.length){if(y(a)){var s={};e(a,function(a,b){s[a]=c(a,b,f,0,1)});e(s,function(b,f){q(s[b])&&!q(a[b])&&(a[b]=s[b]())});return a}return E(a,function(a){return d[a]})}return c[q(b)?
w:"set"].apply(this,arguments)}function z(a){e(a.$,function(b){var f=b.match(/[?*]/)?x:k;f[b]=F(f[b],a)})}function l(a,b,f){if(g(a)){var h=a.pop();return l(I(h),function(f,c){return l(1==a.length?a[0]:a,b,c)},f)}if(y(a))return e(a,function(b,c){b.match(/[?*]/)?r(b,E(b,function(a){return l(b,c,f)})):a[b]=l(b,c,f)}),a;m[a]&&(m[a](function(b){c.set.call(c.context,a,b,f)}),delete m[a]);return b?a in d?b.call(c.context,d[a],f):c(a,b,r(f||{},G)):a in d}var n=Array.prototype.slice,A=Object.prototype.toString,
g=[].isArray||function(a){return"[object Array]"===A.call(a)},q=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},B=function(a){return!!(""===a||a&&a.charCodeAt&&a.substr)},y=function(a){return B(a)?!1:null==a?"object"==String(a):"[object Object]"===A.call(a)||!0},e=[].forEach?function(a,b){if(g(a)||a.length)n.call(a).forEach(b);else for(var c in a)b(c,a[c])}:function(a,b){if(g(a))for(var c=0,h=a.length;c<h;c++)b(a[c],c);else for(c in a)b(c,a[c])},v={}.keys||function(a){if(g(a))return a;var b=
[],c;for(c in a)b.push(c);return b},F=function(a,b){var c=[];e(a,function(a){a!==b&&c.push(a)});return c},K=function(a){var b,c=[];e(v(a).sort(),function(a){a!=b&&(b=a,c.push(a))});return c},D=function(a,b){var c=[];e(a,function(a){b(a)&&c.push(a)});return c},u=function(a){return a&&"length"in a?a.length:0},J=[].map?function(a,b){return a.map(b)}:function(a,b){for(var c=[],h=0,d=a.length;h<d;h++)c.push(b(a[h],h));return c},L=function(a){return g(a)?n.call(a):y(a)?r(a,{}):a},r=function(a){e(n.call(arguments,
1),function(b){for(var c in b)void 0!==b[c]&&(a[c]=b[c])});return a},w="on",G={once:1},d=H||{},C=[],m={},x={},k={};e([w,"after","test","or"],function(a){c[a]=function(b,c,d){var e=k;c||(c=b,b="__base");(c.$||(c.$=[])).push(a+b);b.match(/[?*]/)&&(e=x);(e[a+b]||(e[a+b]=[])).push(c);return r(c,d)}});r(c,{_:{},context:this,list:{},isPaused:!1,db:d,setterMap:m,events:k,del:z,whenSet:l,isset:l,pause:function(){return c.isPaused?!1:(c.isPaused=!0,c._.set=c.set,c.set=function(){C.push(["set",arguments])},
!0)},play:function(){if(c.isPaused){c.isPaused=!1;var a=EvDa();c.set=c._.set;e(C,function(b){a[b[0]].apply(a,b[1])});C=[];c(a.db);return!0}return!1},setter:function(a,b){m[a]=b;if(k[w+a])return l(a)},when:function(a,b,f){if(B(b))try{var d=new Function("x","return x"+b);d();b=d}catch(e){}return c(a,function(a){(g(b)&&b.sort().join("")===a.sort().join("")||q(b)&&b(a)||a===b)&&f.call(c.context,a)})},incr:function(a,b){b=b||1;return c.set(a,"[object Number]"===A.call(d[a])?d[a]+b:b)},decr:function(a,
b){return c.set(a,d[a]-(b||1)||0)},push:function(a,b){1==u(arguments)&&(b=a,a="__base");return c.set(a,[].concat(d[a]||[],[b]))},pop:function(a){return c.set(a||"__base",d[a].slice(0,-1))},traceList:[],group:function(a){var b=n.call(arguments);a=b.shift();b=c.apply(0,b);c.list[a]||(c.list[a]=[]);q(b)?c.list[a].push(b):e(b,function(b,d){c.list[a].push(b)});return function(){return c.group.apply(0,[a].concat(n.call(arguments)))}},extend:function(a,b){return put.set.apply(c.context,[a,r({},d[a],b)].concat(n.call(arguments,
2)))},set:function(a,b,f,h,s){var p="test"+a,g=n.call(arguments),l=u(k[p]),m=l&&!h,q,t=m?function(d){q|=!1===d;--l||(q?e(k["or"+a]||[],function(a){a.S||(a.call(c.context,b,f),a.once&&z(a))}):c.set(a,b,f,1))}:{};t.old=L(d[a]);r(t,{meta:f||{},done:t,result:t,key:a});if(m)e(k[p],function(a){a.call(c.context,b,t)});else return e(c.traceList,function(a){a.call(c.context,g)}),d[a]=b,p=function(){e((k[w+a]||[]).concat(k["after"+a]||[]),function(a){a.S||(a.call(c.context,b,t),a.once&&z(a))});return b},s?
p:p.call(c.context);return d[a]},once:function(a,b,f){return b?c.once(c(a,b,f)):r(a,G)},enable:function(a){e(c.list[a],function(b){b.S&&b.S[a]&&delete b.S[a];0==u(b.S)&&delete b.S});return c.list[a]},setadd:function(a,b){return c(a,K((d[a]||[]).concat([b])))},setdel:function(a,b){return c(a,F(d[a]||[],b))},disable:function(a){e(c.list[a],function(b){(b.S||(b.S={}))[a]=!0});return c.list[a]},unset:function(){var a=!0;e(arguments,function(b){a&=b in d;delete d[b]});return a},find:function(a){return D(v(d),
function(b){return b.match(a)})},changed:function(a,b){b||(b=a,a="__base");return c.on(a,function(a,d){var e=u(a),p=u(d.old);1==e-p?b.call(c.context,a.length?a[a.length-1]:void 0):e>p&&b.call(c.context,n.call(a).slice(p))})},sniff:function(){var a={},b=+new Date,d=function(c){a[c[0]]||console.log(+new Date-b,c)},e=function(){},g=d;c.traceList.unshift(function(a){g(a)});c.sniff=function(b){if(0<arguments.length){if(B(b))return a[b]=!a[b],"[Un]ignoring "+b;g=b?d:e;return b}return v(a)}}});c.setAdd=
c.setadd;c.setDel=c.setdel;c.isSet=c.isset;c.get=c;c.change=c.on;c.add=c.push;c.isArray=g;return c};
