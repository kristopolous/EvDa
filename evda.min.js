var slice=Array.prototype.slice,toString=Object.prototype.toString,isArray=[].isArray||function(a){return"[object Array]"===toString.call(a)},isFunction=function(a){return!(!a||!a.constructor||!a.call||!a.apply)},isString=function(a){return!!(""===a||a&&a.charCodeAt&&a.substr)},isNumber=function(a){return"[object Number]"===toString.call(a)},isObject=function(a){return isString(a)?!1:null==a?"object"==""+a:"[object Object]"===toString.call(a)||!0},toArray=function(a){return slice.call(a)},each=[].forEach?
function(a,b){if(isArray(a)||a.length)toArray(a).forEach(b);else for(var d in a)b(d,a[d])}:function(a,b){if(isArray(a))for(var d=0,g=a.length;d<g;d++)b(a[d],d);else for(d in a)b(d,a[d])},last=function(a){return a.length?a[a.length-1]:void 0},keys={}.keys||function(a){if(isArray(a))return a;var b=[],d;for(d in a)b.push(d);return b},without=function(a,b){var d=[];each(a,function(a){a!==b&&d.push(a)});return d},uniq=function(a){var b,d=[];each(keys(a).sort(),function(a){a!=b&&(b=a,d.push(a))});return d},
size=function(a){return a&&"length"in a?a.length:0},map=[].map?function(a,b){return a.map(b)}:function(a,b){for(var d=[],g=0,j=a.length;g<j;g++)d.push(b(a[g],g));return d},clone=function(a){return isArray(a)?slice.call(a):isObject(a)?extend(a,{}):a},extend=function(a){each(slice.call(arguments,1),function(b){for(var d in b)void 0!==b[d]&&(a[d]=b[d])});return a};
function EvDa(a){function b(c,a,d){if(1==arguments.length){if(isObject(c)){var i={};each(c,function(c,a){i[c]=b(c,a,d,0,1)});each(i,function(a){isFunction(i[a])&&!isFunction(c[a])&&(c[a]=i[a]())});return c}return isArray(c)?map(c,function(c){return b(c,a,d)}):f[c]}return b[isFunction(a)?l:"set"].apply(this,arguments)}function d(c){each(c.$,function(a){h[a]=without(h[a],c)})}function g(c,a){if(isObject(c))return each(c,function(a,e){c[a]=g(a,e)}),c;k[c]&&(k[c](),k[c]=0);return a?c in f?a(f[c]):b(c,
a,p):c in f}var j=function(c,a){var b=[];each(c,function(c){a(c)&&b.push(c)});return b},l="on",p={once:1},f=a||{},k={},h={};each([l,"after","test"],function(c){b[c]=function(a,b,d){b||(b=a,a="__base");(b.$||(b.$=[])).push(c+a);(h[c+a]||(h[c+a]=[])).push(b);return extend(b,d)}});extend(b,{list:{},db:f,events:h,del:d,isset:g,setter:function(c,a){k[c]=a;h[l+c]&&g(c)},incr:function(a){return b.set(a,isNumber(f[a])?f[a]+1:1)},decr:function(a){return b.set(a,f[a]-1||0)},push:function(a,e){1==size(arguments)&&
(e=a,a="__base");return b.set(a,[].concat(f[a]||[],[e]))},pop:function(a){return b.set(a||"__base",f[a].slice(0,-1))},group:function(a){var e=toArray(arguments),a=e.shift(),e=b.apply(0,e);b.list[a]||(b.list[a]=[]);isFunction(e)?b.list[a].push(e):each(e,function(e){b.list[a].push(e)});return function(){return b.group.apply(0,[a].concat(toArray(arguments)))}},set:function(a,e,g,i,k){var n="test"+a,j=size(h[n]),m,o={meta:g||{},old:clone(f[a]),key:a,done:function(d){m|=!1===d;--j||m||b.set(a,e,g,1)}};
if(j&&!i)each(h[n],function(a){a(e,o)});else return f[a]=e,i=function(){each((h[l+a]||[]).concat(h["after"+a]||[]),function(a){a.S||(a(e,o),a.once&&d(a))});return e},k?i:i();return e},once:function(a,e){return b(a,e,{once:!0})},enable:function(a){each(b.list[a],function(b){b.S&&b.S[a]&&delete b.S[a];0==size(b.S)&&delete b.S})},setadd:function(a,e){return b(a,uniq((f[a]||[]).concat([e])))},setdel:function(a,e){return b(a,without(f[a]||[],e))},disable:function(a){each(b.list[a],function(b){(b.S||(b.S=
{}))[a]=!0})},unset:function(){each(arguments,function(a){delete f[a]})},find:function(a){return j(keys(f),function(b){return b.match(a)})},added:function(a,e){e||(e=a,a="__base");b.on(a,function(a,b){var c=size(a),d=size(b.old);c-d==1?e(last(a)):c>d&&e(toArray(a).slice(d))})},sniff:function(){b.set_=b.set;var a={};b.set=function(){var d=slice(arguments);a[d[0]]||console.log(+new Date,d);b.set_.apply(this,d)};b.sniff=function(b){if(b)return a[b]=!a[b],"[Un]ignoring "+b;console.log(keys(a))}}});b.change=
b.on;b.add=b.push;return b};
