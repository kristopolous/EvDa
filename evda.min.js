function EvDa(G){function H(a,b){return a.match(/[?*]/)?C(v(b?b:d),function(b){return b.match(a)}):a}function D(a,b){var e={};return g(a)?(f(a,function(c){e[a]=b(a)}),e):b(a)}function c(a,b,e){if(!a)return{data:d,setters:k,events:h,globs:y};if(g(a)){var x=l.call(arguments,1);return I(a,function(a){return c.apply(c.context,[a].concat(x))})}if(1==arguments.length){if(n(a)){var t={};f(a,function(a,b){t[a]=c(a,b,e,0,1)});f(t,function(b,e){p(t[b])&&!p(a[b])&&(a[b]=t[b]())});return a}return D(a,function(a){return d[a]})}return c[p(b)?
"on":"set"].apply(this,arguments)}function z(a){f(a.$,function(b){var e=b.match(/[?*]/)?y:h;e[b]=E(e[b],a)})}function q(a,b,e){if(g(a)){var x=a.pop();return q(H(x),function(e,c){return q(1==a.length?a[0]:a,b,c)},e)}if(n(a))return f(a,function(b,c){b.match(/[?*]/)?r(b,D(b,function(a){return q(b,c,e)})):a[b]=q(b,c,e)}),a;k[a]&&(k[a](function(b){c.set.call(c.context,a,b,e)}),delete k[a]);return b?a in d?b.call(c.context,d[a],e):c(a,b,r(e||{},F)):a in d}var l=Array.prototype.slice,w=Object.prototype.toString,
g=[].isArray||function(a){return"[object Array]"===w.call(a)},p=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},A=function(a){return!!(""===a||a&&a.charCodeAt&&a.substr)},n=function(a){return p(a)||A(a)||"[object Number]"===w.call(a)||g(a)?!1:null==a?"object"==String(a):"[object Object]"===w.call(a)||!0},f=[].forEach?function(a,b){if(g(a)||a.length)l.call(a).forEach(b);else for(var e in a)b(e,a[e])}:function(a,b){if(g(a))for(var e=0,c=a.length;e<c;e++)b(a[e],e);else for(e in a)b(e,a[e])},
v={}.keys||function(a){if(g(a))return a;var b=[],c;for(c in a)b.push(c);return b},E=function(a,b){var c=[];f(a,function(a){a!==b&&c.push(a)});return c},J=function(a){var b,c=[];f(v(a).sort(),function(a){a!=b&&(b=a,c.push(a))});return c},C=function(a,b){var c=[];f(a,function(a){b(a)&&c.push(a)});return c},u=function(a){return a&&"length"in a?a.length:0},I=[].map?function(a,b){return a.map(b)}:function(a,b){for(var c=[],d=0,f=a.length;d<f;d++)c.push(b(a[d],d));return c},K=function(a){return g(a)?l.call(a):
n(a)?r(a,{}):a},r=function(a){f(l.call(arguments,1),function(b){for(var c in b)void 0!==b[c]&&(n(b[c])&&n(a[c])?r(a[c],b[c]):a[c]=b[c])});return a},F={once:1},d=G||{},B=[],k={},y={},h={};f(["first","on","after","test","or"],function(a){c[a]=function(b,c,d){var f=h;c||(c=b,b="__base");(c.$||(c.$=[])).push(a+b);b.match(/[?*]/)&&(f=y);(f[a+b]||(f[a+b]=[])).push(c);return r(c,d)}});r(c,{_:{},context:this,list:{},isPaused:!1,db:d,setterMap:k,events:h,del:z,whenSet:q,isset:q,pause:function(){return c.isPaused?
!1:(c.isPaused=!0,c._.set=c.set,c.set=function(){B.push(["set",arguments])},!0)},play:function(){if(c.isPaused){c.isPaused=!1;var a=EvDa();c.set=c._.set;f(B,function(b){a[b[0]].apply(a,b[1])});B=[];c(a.db);return!0}return!1},setter:function(a,b){k[a]=b;if(h["on"+a])return q(a)},when:function(a,b,e){if(A(b))try{var d=new Function("x","return x"+b);d();b=d}catch(f){}return c(a,function(a){(g(b)&&b.sort().join("")===a.sort().join("")||p(b)&&b(a)||a===b)&&e.call(c.context,a)})},incr:function(a,b){b=b||
1;return c.set(a,"[object Number]"===w.call(d[a])?d[a]+b:b)},decr:function(a,b){return c.set(a,d[a]-(b||1)||0)},push:function(a,b){1==u(arguments)&&(b=a,a="__base");return c.set(a,[].concat(d[a]||[],[b]))},pop:function(a){return c.set(a||"__base",d[a].slice(0,-1))},traceList:[],group:function(a){var b=l.call(arguments);a=b.shift();b=c.apply(0,b);c.list[a]||(c.list[a]=[]);p(b)?c.list[a].push(b):f(b,function(b,d){c.list[a].push(b)});return function(){return c.group.apply(0,[a].concat(l.call(arguments)))}},
extend:function(a,b){return c.set.apply(c.context,[a,r({},d[a],b)].concat(l.call(arguments,2)))},set:function(a,b,e,g,t){var m="test"+a,q=l.call(arguments),k=u(h[m]),p=k&&!g,n,s=p?function(d){n|=!1===d;--k||(n?f(h["or"+a]||[],function(a){a.S||(a.call(c.context,b,e),a.once&&z(a))}):c.set(a,b,e,1))}:{};s.old=K(d[a]);r(s,{meta:e||{},done:s,result:s,key:a});if(p)f(h[m],function(a){a.call(c.context,b,s)});else return f(c.traceList,function(a){a.call(c.context,q)}),d[a]=b,m=function(){f((h["first"+a]||
[]).concat(h["on"+a]||[],h["after"+a]||[]),function(a){a.S||(a.call(c.context,b,s),a.once&&z(a));s.last=void 0});return b},t?m:m.call(c.context);return d[a]},fire:function(a){c.set(a,d[a])},once:function(a,b,e){return b?c.once(c(a,b,e)):r(a,F)},enable:function(a){f(c.list[a],function(b){b.S&&b.S[a]&&delete b.S[a];0==u(b.S)&&delete b.S});return c.list[a]},setadd:function(a,b){b=g(b)?b:[b];return c(a,J((d[a]||[]).concat(b)))},setdel:function(a,b){return c(a,E(d[a]||[],b))},disable:function(a){f(c.list[a],
function(b){(b.S||(b.S={}))[a]=!0});return c.list[a]},unset:function(){var a=!0;f(arguments,function(b){a&=b in d;delete d[b]});return a},find:function(a){return C(v(d),function(b){return b.match(a)})},changed:function(a,b){b||(b=a,a="__base");return c.on(a,function(a,d){var f=u(a),m=u(d.old);1==f-m?b.call(c.context,a.length?a[a.length-1]:void 0):f>m&&b.call(c.context,l.call(a).slice(m))})},sniff:function(){var a={},b=+new Date,e=function(c){a[c[0]]||console.log(+new Date-b,c)},d=function(){},f=e;
c.traceList.unshift(function(a){f(a)});c.sniff=function(b){if(0<arguments.length){if(A(b))return a[b]=!a[b],"[Un]ignoring "+b;f=b?e:d;return b}return v(a)}}});c.setAdd=c.setadd;c.setDel=c.setdel;c.isSet=c.isset;c.get=c;c.change=c.on;c.add=c.push;c.isArray=g;return c};
