<!doctype html>
<html>
<head>
  <title>EvDa test suite</title>
  <link rel=stylesheet href=qunit.css>
  <script src="http://code.jquery.com/jquery-latest.js"></script>
  <script src=underscore.js > </script>
  <script src=../evda.js > </script>
  <script src=qunit.js > </script>
</head>
<body>
  <h1 id=qunit-header>EvDa test suite</h1>
  <h2 id="qunit-banner"></h2>
  <div id="qunit-testrunner-toolbar"></div>
  <h2 id="qunit-userAgent"></h2>
  <ol id="qunit-tests"></ol>
  <div id="qunit-fixture">test markup, will be hidden</div>
</body>
<script>
$(function(){
module("Initialization");
  test("No arguments", function(){
    var ev = EvDa();
    equal(_.keys(ev()).join(' '), 'data events', "Initialized");
  });

  test("K/V pair", function(){
    var ev = EvDa({key: 'value'});
    equal(ev().data.key, 'value', "Initialized");
  });

module("Basic");
  test("Set a key", function(){
    var ev = EvDa();
    ev('key', 'value');
    equal(ev().data.key, 'value', "Initialized");
  });

  test("Get a key", function(){
    var ev = EvDa();
    ev('key', 'value');
    equal(ev('key'), 'value', "Initialized");
  });

  test("Unset a key", function(){
    var ev = EvDa();
    ev('key', 'value');
    equal(ev().data.key, 'value', "Initialized");
    ev.unset('key')
    equal(_.keys(ev().data).join(''), '', "Removed");
  });

module("Callbacks on set");
  test("register a callback, arglist style", function(){
    expect(1);
    var ev = EvDa();

    ev('key', function(value) {
      equal(value, 'value', 'Callback triggered');
    });

    ev('key', 'value');
  });

  test("register a callback, object style", function(){
    expect(1);
    var ev = EvDa();

    ev({key: function(value) {
      equal(value, 'value', 'Callback triggered');
    }});

    ev('key', 'value');
  });

  test("register a callback, list style", function(){
    expect(1);
    var ev = EvDa();

    ev(['key'], function(value) {
      equal(value, 'value', 'Callback triggered');
    });

    ev('key', 'value');
  });

  test("register a callback, expect meta information", function(){
    var ev = EvDa();

    ev(['key'], function(value, meta) {
      equal(_.keys(meta).join(' '), 'meta old now key del', 'Meta information there');
      equal(meta.old, undefined, 'Old value correct');
      equal(meta.now, 'value', 'Now value correct');
      equal(meta.key, 'key', 'key correct');
    });

    ev('key', 'value');
  });

  test("register a callback, pass meta information", function(){
    expect(1);
    var ev = EvDa();

    ev('key', function(value, meta) {
      equal(meta.meta, 'meta', 'meta info correct');
    });

    ev('key', 'value', 'meta');
  });

module("Onetime callbacks on set");
  test("register a one time callback, set twice", function(){
    expect(1);
    var ev = EvDa();

    ev.once('key', function(value) {
      equal(value, 'value', 'Callback triggered');
    });

    ev('key', 'value');
    ev('key', 'value');
  });

module("Callbacks after set");
module("Test callbacks on set");
module("Avoiding recursion");
module("Defining a setter");

});
</script>


